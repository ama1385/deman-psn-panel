<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <title>Ù„ÙˆØ­Ø© DEMAN Panel - PSN Tools</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #05050a;
            color: #f9fafb;
        }
        .page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }
        .card {
            background: #111827;
            border-radius: 18px;
            padding: 24px;
            max-width: 1000px;
            width: 100%;
            box-shadow: 0 20px 50px rgba(0,0,0,0.7);
            border: 1px solid rgba(129, 140, 248, 0.35);
        }
        h1 {
            margin: 0 0 8px;
            font-size: 26px;
        }
        .subtitle {
            margin: 0 0 20px;
            color: #9ca3af;
            font-size: 14px;
        }
        label {
            font-size: 14px;
            margin-bottom: 4px;
            display: block;
        }
        input[type="email"],
        input[type="password"],
        input[type="text"] {
            width: 100%;
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid #374151;
            background: #020617;
            color: #e5e7eb;
            outline: none;
            font-size: 14px;
        }
        input:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 1px rgba(99,102,241,0.7);
        }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 999px;
            padding: 10px 18px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            gap: 6px;
            transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.1s ease;
        }
        .btn-primary {
            background: linear-gradient(135deg,#4f46e5,#7c3aed);
            color: #f9fafb;
            box-shadow: 0 12px 30px rgba(79,70,229,0.5);
        }
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 16px 40px rgba(79,70,229,0.7);
        }
        .btn-ghost {
            background: transparent;
            color: #9ca3af;
            border: 1px solid #374151;
        }
        .btn-ghost:hover {
            background: #111827;
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: default;
            transform: none;
            box-shadow: none;
        }
        .row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        .row > .col {
            flex: 1 1 0;
            min-width: 0;
        }
        .mt-8 { margin-top: 8px; }
        .mt-12 { margin-top: 12px; }
        .mt-16 { margin-top: 16px; }
        .mt-24 { margin-top: 24px; }
        .mb-8 { margin-bottom: 8px; }
        .mb-16 { margin-bottom: 16px; }
        .text-sm { font-size: 14px; }
        .text-xs { font-size: 12px; }
        .text-muted { color: #9ca3af; }
        .tag {
            display: inline-flex;
            align-items: center;
            padding: 2px 10px;
            border-radius: 999px;
            font-size: 11px;
            background: rgba(31,41,55,0.9);
            color: #e5e7eb;
        }
        .tag-green {
            background: rgba(16,185,129,0.15);
            color: #6ee7b7;
        }
        .tag-yellow {
            background: rgba(234,179,8,0.15);
            color: #facc15;
        }
        .tag-red {
            background: rgba(248,113,113,0.15);
            color: #fecaca;
        }
        .tag-blue {
            background: rgba(59,130,246,0.15);
            color: #bfdbfe;
        }
        .section-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        .divider {
            border-top: 1px solid #1f2937;
            margin: 16px 0;
        }
        .cards-grid {
            display: grid;
            gap: 12px;
        }
        @media (min-width: 768px) {
            .cards-grid {
                grid-template-columns: 2.2fr 1.8fr;
            }
        }
        .subcard {
            background: radial-gradient(circle at top left, rgba(79,70,229,0.32), transparent 55%);
            border-radius: 16px;
            border: 1px solid rgba(55,65,81,0.9);
            padding: 14px;
        }
        .subcard-soft {
            background: #020617;
            border-radius: 16px;
            border: 1px solid #1f2937;
            padding: 14px;
        }
        .pill-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.09em;
            color: #6b7280;
            margin-bottom: 4px;
        }
        .big-number {
            font-size: 20px;
            font-weight: 600;
        }
        .textarea {
            width: 100%;
            min-height: 120px;
            padding: 10px 12px;
            border-radius: 12px;
            border: 1px solid #374151;
            background: #020617;
            color: #e5e7eb;
            font-size: 13px;
            resize: vertical;
        }
        .textarea:focus {
            border-color: #6366f1;
            outline: none;
            box-shadow: 0 0 0 1px rgba(99,102,241,0.7);
        }
        .status-text {
            font-size: 13px;
            min-height: 18px;
        }
        .status-text.error {
            color: #fecaca;
        }
        .status-text.success {
            color: #6ee7b7;
        }

        /* ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø¨Ø³ÙŠØ·Ø© */
        .tabs {
            display: flex;
            gap: 8px;
            border-bottom: 1px solid #1f2937;
            margin-bottom: 16px;
            padding-bottom: 4px;
        }
        .tab {
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 13px;
            cursor: pointer;
            color: #9ca3af;
        }
        .tab.active {
            background: rgba(79,70,229,0.22);
            color: #e5e7eb;
        }

        .hidden { display: none; }
        .avatar {
            width: 100%;
            max-width: 120px;
            border-radius: 18px;
            border: 1px solid #374151;
        }
    </style>
</head>
<body>
<div class="page">
    <div class="card">
        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <div class="row" style="align-items: center; margin-bottom: 16px;">
            <div class="col">
                <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… ÙØ±ÙŠÙ‚ DEMAN</h1>
                <p class="subtitle">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† + Ø£Ø¯Ø§Ø© ØªØ­Ù„ÙŠÙ„ Ø­Ø³Ø§Ø¨Ø§Øª PSN Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡.</p>
            </div>
            <div style="text-align:left; min-width: 120px;">
                <span class="tag tag-blue" id="user-badge" style="display:none;">
                    Ù…ÙˆØ¸Ù: <span id="user-name-span"></span>
                </span>
            </div>
        </div>

        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
        <div id="login-section">
            <p class="text-sm text-muted mb-16">
                Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø¨Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸Ù ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© Ù„Ù„ÙˆØ­Ø©.
            </p>
            <div class="row">
                <div class="col">
                    <label for="email-input">Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸Ù</label>
                    <input id="email-input" type="email" placeholder="name@deman.store Ø£Ùˆ Ø¥ÙŠÙ…ÙŠÙ„ Ø¬ÙˆØ¬Ù„" />
                </div>
                <div class="col">
                    <label for="password-input">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©</label>
                    <input id="password-input" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
                </div>
            </div>
            <div class="row mt-16" style="align-items:center;">
                <button id="login-btn" class="btn btn-primary">
                    <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
                </button>
                <span id="login-status" class="status-text text-sm"></span>
            </div>
        </div>

        <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
        <div id="dashboard-section" class="hidden">
            <!-- Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ -->
            <div class="row" style="align-items:center; margin-bottom: 8px;">
                <div class="col">
                    <span class="pill-label">Ù…Ø±Ø­Ø¨Ù‹Ø§</span>
                    <div class="text-sm">
                        <strong id="dash-username"></strong>ØŒ Ø¬Ø§Ù‡Ø² ØªØ´ØªØºÙ„ Ø¹Ù„Ù‰ Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ… ğŸ‘Œ
                    </div>
                </div>
                <div style="text-align:left; min-width: 140px;">
                    <button id="logout-btn" class="btn btn-ghost text-xs">
                        ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
                    </button>
                </div>
            </div>

            <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
            <div class="tabs">
                <div class="tab active" data-tab="psn-tab">ØªØ­Ù„ÙŠÙ„ Ø­Ø³Ø§Ø¨ PSN</div>
                <div class="tab" data-tab="coming-tab">Ø£Ø¯ÙˆØ§Øª Ù‚Ø§Ø¯Ù…Ø©</div>
            </div>

            <!-- ØªØ¨ÙˆÙŠØ¨ PSN -->
            <div id="psn-tab" class="tab-panel">
                <!-- ÙÙˆØ±Ù… Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ -->
                <div class="subcard-soft mb-16">
                    <div class="section-title">ØªØ­Ù„ÙŠÙ„ Ø­Ø³Ø§Ø¨ PSN Ù„Ù„Ø¹Ù…ÙŠÙ„</div>
                    <p class="text-xs text-muted mb-8">
                        Ø§ÙƒØªØ¨ Ø§Ù„Ù€ Online ID Ù„Ù„Ø­Ø³Ø§Ø¨ØŒ ÙˆØ³ÙŠØªÙ… Ø¬Ù„Ø¨ ØªÙ‚Ø±ÙŠØ± ØªØ­Ù„ÙŠÙ„ÙŠ + Ù†Øµ Ø¬Ø§Ù‡Ø² Ù„Ø¥Ø±Ø³Ø§Ù„Ù‡ Ù„Ù„Ø¹Ù…ÙŠÙ„.
                    </p>
                    <div class="row">
                        <div class="col">
                            <label for="psn-id-input">Online ID</label>
                            <input id="psn-id-input" type="text" placeholder="Ù…Ø«Ø§Ù„: Twli- Ø£Ùˆ ID Ø§Ù„Ø¹Ù…ÙŠÙ„" />
                        </div>
                        <div style="display:flex; align-items:flex-end;">
                            <button id="analyze-btn" class="btn btn-primary">
                                ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ­Ù„ÙŠÙ„
                            </button>
                        </div>
                    </div>
                    <div id="psn-status" class="status-text text-sm mt-8"></div>
                </div>

                <!-- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¹Ù„Ù‰ Ø´ÙƒÙ„ ÙƒØ±ÙˆØª -->
                <div class="cards-grid">
                    <!-- Ø¹Ù…ÙˆØ¯ Ø§Ù„ÙŠØ³Ø§Ø±: Ù…Ù„Ø®Øµ + Ø§Ù„Ø­Ø§Ù„Ø© + Ø§Ù„ØªØ±ÙˆÙÙŠØ² -->
                    <div class="cards-column">
                        <!-- ÙƒØ±Øª Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¹Ù„Ù‰ -->
                        <div class="subcard mb-12">
                            <div class="row" style="align-items: center;">
                                <div class="col">
                                    <div class="pill-label">Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø³Ø§Ø¨</div>
                                    <div class="text-sm">
                                        <span id="psn-online-id">â€”</span>
                                    </div>
                                </div>
                                <div style="text-align:left; min-width: 110px;">
                                    <span id="psn-region-tag" class="tag">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©: â€”</span>
                                </div>
                            </div>

                            <div class="row mt-12">
                                <div class="col">
                                    <div class="pill-label">Ø§Ù„Ù‚ÙŠÙ…Ø©</div>
                                    <div class="big-number" id="psn-value-segment">â€”</div>
                                </div>
                                <div class="col">
                                    <div class="pill-label">Ø§Ù„Ù†Ø´Ø§Ø·</div>
                                    <div class="text-sm" id="psn-activity-segment">â€”</div>
                                </div>
                            </div>

                            <div class="row mt-12">
                                <div class="col">
                                    <div class="pill-label">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø®Ø§Ø·Ø±</div>
                                    <span id="psn-risk-tag" class="tag">â€”</span>
                                </div>
                            </div>

                            <div class="mt-12 text-sm" id="psn-worth-line">
                                â€”  
                            </div>
                        </div>

                        <!-- ÙƒØ±Øª Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
                        <div class="subcard-soft mb-12">
                            <div class="section-title">Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¢Ù†</div>
                            <div class="text-sm">
                                <div class="mb-4">
                                    <span class="pill-label">Ø§Ù„Ø­Ø§Ù„Ø©</span><br />
                                    <span id="psn-presence">â€”</span>
                                </div>
                                <div>
                                    <span class="pill-label">Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</span><br />
                                    <span id="psn-current-title">â€”</span>
                                </div>
                            </div>
                        </div>

                        <!-- ÙƒØ±Øª Ø§Ù„ØªØ±ÙˆÙÙŠØ² -->
                        <div class="subcard-soft">
                            <div class="section-title">Ø§Ù„ØªØ±ÙˆÙÙŠØ²</div>
                            <div class="text-xs text-muted mb-4" id="psn-trophy-summary">
                                â€” 
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="pill-label">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</div>
                                    <div class="big-number" id="psn-trophy-level">â€”</div>
                                </div>
                                <div class="col">
                                    <div class="pill-label">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                                    <div class="big-number" id="psn-trophy-total">â€”</div>
                                </div>
                            </div>
                            <div class="row mt-12 text-sm">
                                <div class="col">
                                    ğŸ† Ø¨Ù„Ø§ØªÙŠÙ†ÙŠÙˆÙ…: <span id="psn-trophy-plat">0</span>
                                </div>
                                <div class="col">
                                    ğŸ¥‡ Ø°Ù‡Ø¨ÙŠ: <span id="psn-trophy-gold">0</span>
                                </div>
                            </div>
                            <div class="row mt-8 text-sm">
                                <div class="col">
                                    ğŸ¥ˆ ÙØ¶ÙŠ: <span id="psn-trophy-silver">0</span>
                                </div>
                                <div class="col">
                                    ğŸ¥‰ Ø¨Ø±ÙˆÙ†Ø²ÙŠ: <span id="psn-trophy-bronze">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ø¹Ù…ÙˆØ¯ Ø§Ù„ÙŠÙ…ÙŠÙ†: Ø£Ù„Ø¹Ø§Ø¨ ÙˆØ£ØµØ¯Ù‚Ø§Ø¡ + Ù…Ø®Ø§Ø·Ø± + Ù†ØµÙˆØµ -->
                    <div class="cards-column">
                        <!-- ÙƒØ±Øª Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ ÙˆØ§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ -->
                        <div class="subcard-soft mb-12">
                            <div class="section-title">Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ ÙˆØ§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</div>
                            <div class="text-sm">
                                <div class="mb-4">
                                    ğŸ® Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ (Trophy Titles): 
                                    <strong id="psn-titles-count">â€”</strong>
                                </div>
                                <div class="mb-4">
                                    ğŸ‘¥ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ Ø§Ù„ÙƒÙ„ÙŠ: 
                                    <strong id="psn-friends-total">â€”</strong>
                                </div>
                                <div>
                                    ğŸŸ¢ Ø£ØµØ¯Ù‚Ø§Ø¡ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† (ØªÙ‚Ø¯ÙŠØ±ÙŠ): 
                                    <strong id="psn-friends-online">â€”</strong>
                                </div>
                            </div>
                        </div>

                        <!-- ÙƒØ±Øª Ø§Ù„Ù…Ø®Ø§Ø·Ø± + Ø§Ù„Ø£ÙØ§ØªØ§Ø± -->
                        <div class="subcard-soft mb-12">
                            <div class="section-title">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„Ø£ÙØ§ØªØ§Ø±</div>
                            <div class="text-sm mb-8" id="psn-risk-flags">
                                Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø®Ø§Ø·Ø± Ø¥Ø¶Ø§ÙÙŠØ©.
                            </div>
                            <div style="display:flex; gap: 12px; align-items:flex-start;">
                                <div style="flex:1;">
                                    <span class="pill-label">Ø±Ø§Ø¨Ø· Ø§Ù„Ø£ÙØ§ØªØ§Ø±</span>
                                    <div class="text-xs" id="psn-avatar-url">â€”</div>
                                </div>
                                <div style="text-align:left;">
                                    <img id="psn-avatar-img" class="avatar" src="" alt="Avatar" style="display:none;" />
                                </div>
                            </div>
                        </div>

                        <!-- Ù†Øµ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø§Ù‡Ø² + Ø²Ø± Ù†Ø³Ø® -->
                        <div class="subcard-soft">
                            <div class="section-title">Ù†Øµ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…ÙŠÙ„</div>
                            <textarea id="client-message-textarea" class="textarea" placeholder="Ø§Ù„Ù†Øµ Ø§Ù„Ø¬Ø§Ù‡Ø² Ø¨ÙŠØ·Ù„Ø¹ Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù„ÙŠÙ„"></textarea>
                            <div class="row mt-8" style="align-items:center;">
                                <button id="copy-client-message-btn" class="btn btn-ghost text-xs">
                                    Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ù„Ù„Ø¹Ù…ÙŠÙ„
                                </button>
                                <span id="copy-status" class="status-text text-xs"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ØªÙ‚Ø±ÙŠØ± Ø¯Ø§Ø®Ù„ÙŠ ÙƒÙ†Øµ ÙƒØ§Ù…Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) -->
                <div class="divider mt-24"></div>
                <div>
                    <div class="section-title">ØªÙ‚Ø±ÙŠØ± Ø¯Ø§Ø®Ù„ÙŠ ÙƒØ§Ù…Ù„ (Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©)</div>
                    <textarea id="internal-report-textarea" class="textarea" style="min-height: 140px;"
                              placeholder="Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ù† Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§..."></textarea>
                </div>
            </div>

            <!-- ØªØ¨ÙˆÙŠØ¨ Ø«Ø§Ù†ÙŠ (Ù‚Ø§Ø¯Ù…) -->
            <div id="coming-tab" class="tab-panel hidden">
                <div class="subcard-soft">
                    <div class="section-title">Ø£Ø¯ÙˆØ§Øª Ù‚Ø§Ø¯Ù…Ø©</div>
                    <p class="text-sm text-muted">
                        Ù‡Ù†Ø§ Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹ ØªØ¶ÙŠÙ Ø£Ø¯ÙˆØ§Øª Ø«Ø§Ù†ÙŠØ© (ÙÙ„ØªØ±Ø© NPSSO, Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†, ØªÙ‚Ø§Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠØ©... Ø¥Ù„Ø®).
                        Ø­Ø§Ù„ÙŠØ§Ù‹ ÙƒÙ„ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ ØªØ¨ÙˆÙŠØ¨ ØªØ­Ù„ÙŠÙ„ Ø­Ø³Ø§Ø¨ PSN.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Ø¹Ù†Ø§ØµØ± Ø¹Ø§Ù…Ø©
    const loginSection = document.getElementById("login-section");
    const dashboardSection = document.getElementById("dashboard-section");
    const userBadge = document.getElementById("user-badge");
    const dashUsernameSpan = document.getElementById("dash-username");
    const userNameSpan = document.getElementById("user-name-span");

    // Ø¹Ù†Ø§ØµØ± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    const emailInput = document.getElementById("email-input");
    const passwordInput = document.getElementById("password-input");
    const loginBtn = document.getElementById("login-btn");
    const loginStatus = document.getElementById("login-status");
    const logoutBtn = document.getElementById("logout-btn");

    // Ø¹Ù†Ø§ØµØ± PSN
    const psnIdInput = document.getElementById("psn-id-input");
    const analyzeBtn = document.getElementById("analyze-btn");
    const psnStatus = document.getElementById("psn-status");

    // ÙƒØ±ÙˆØª Ø§Ù„Ù…Ù„Ø®Øµ
    const psnOnlineId = document.getElementById("psn-online-id");
    const psnRegionTag = document.getElementById("psn-region-tag");
    const psnValueSegment = document.getElementById("psn-value-segment");
    const psnActivitySegment = document.getElementById("psn-activity-segment");
    const psnRiskTag = document.getElementById("psn-risk-tag");
    const psnWorthLine = document.getElementById("psn-worth-line");

    // Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨
    const psnPresence = document.getElementById("psn-presence");
    const psnCurrentTitle = document.getElementById("psn-current-title");

    // Ø§Ù„ØªØ±ÙˆÙÙŠØ²
    const psnTrophySummary = document.getElementById("psn-trophy-summary");
    const psnTrophyLevel = document.getElementById("psn-trophy-level");
    const psnTrophyTotal = document.getElementById("psn-trophy-total");
    const psnTrophyPlat = document.getElementById("psn-trophy-plat");
    const psnTrophyGold = document.getElementById("psn-trophy-gold");
    const psnTrophySilver = document.getElementById("psn-trophy-silver");
    const psnTrophyBronze = document.getElementById("psn-trophy-bronze");

    // Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ ÙˆØ§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡
    const psnTitlesCount = document.getElementById("psn-titles-count");
    const psnFriendsTotal = document.getElementById("psn-friends-total");
    const psnFriendsOnline = document.getElementById("psn-friends-online");

    // Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„Ø£ÙØ§ØªØ§Ø±
    const psnRiskFlags = document.getElementById("psn-risk-flags");
    const psnAvatarUrl = document.getElementById("psn-avatar-url");
    const psnAvatarImg = document.getElementById("psn-avatar-img");

    // Ø§Ù„Ù†ØµÙˆØµ
    const clientMessageTextarea = document.getElementById("client-message-textarea");
    const internalReportTextarea = document.getElementById("internal-report-textarea");
    const copyClientMessageBtn = document.getElementById("copy-client-message-btn");
    const copyStatus = document.getElementById("copy-status");

    // ØªØ¨ÙˆÙŠØ¨Ø§Øª
    const tabButtons = document.querySelectorAll(".tab");
    const tabPanels = document.querySelectorAll(".tab-panel");

    tabButtons.forEach(btn => {
        btn.addEventListener("click", () => {
            const target = btn.getAttribute("data-tab");
            tabButtons.forEach(t => t.classList.remove("active"));
            tabPanels.forEach(p => p.classList.add("hidden"));
            btn.classList.add("active");
            document.getElementById(target).classList.remove("hidden");
        });
    });

    // ---- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ----
    async function handleLogin() {
        loginStatus.textContent = "";
        loginStatus.className = "status-text text-sm";

        const email = (emailInput.value || "").trim();
        const password = passwordInput.value || "";

        if (!email || !password) {
            loginStatus.textContent = "Ø±Ø¬Ø§Ø¡Ù‹ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.";
            loginStatus.classList.add("error");
            return;
        }

        loginBtn.disabled = true;
        loginStatus.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";
        try {
            const res = await fetch("/api/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, password }),
            });

            const data = await res.json();

            if (!res.ok || !data.ok) {
                loginStatus.textContent = data.message || "ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.";
                loginStatus.classList.add("error");
                loginBtn.disabled = false;
                return;
            }

            // Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¯Ø®ÙˆÙ„
            loginStatus.textContent = "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­.";
            loginStatus.classList.add("success");

            const name = data.name || "Ù…ÙˆØ¸Ù";
            dashUsernameSpan.textContent = name;
            userNameSpan.textContent = name;
            userBadge.style.display = "inline-flex";

            loginSection.classList.add("hidden");
            dashboardSection.classList.remove("hidden");
        } catch (err) {
            console.error(err);
            loginStatus.textContent = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±.";
            loginStatus.classList.add("error");
            loginBtn.disabled = false;
        } finally {
            loginBtn.disabled = false;
        }
    }

    loginBtn.addEventListener("click", handleLogin);
    passwordInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") handleLogin();
    });

    // ---- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ----
    logoutBtn.addEventListener("click", async () => {
        try {
            await fetch("/api/logout", { method: "POST" });
        } catch (e) {}
        dashboardSection.classList.add("hidden");
        loginSection.classList.remove("hidden");
        userBadge.style.display = "none";
        dashUsernameSpan.textContent = "";
    });

    // ---- Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ ØªØ­Ù„ÙŠÙ„ PSN ----
    analyzeBtn.addEventListener("click", async () => {
        psnStatus.textContent = "";
        psnStatus.className = "status-text text-sm";

        const onlineId = (psnIdInput.value || "").trim();
        if (!onlineId) {
            psnStatus.textContent = "Ø±Ø¬Ø§Ø¡Ù‹ Ø§ÙƒØªØ¨ Online ID Ø£ÙˆÙ„Ø§Ù‹.";
            psnStatus.classList.add("error");
            return;
        }

        analyzeBtn.disabled = true;
        psnStatus.textContent = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ØŒ Ø«ÙˆØ§Ù†ÙŠ...";
        try {
            const res = await fetch("/api/psn-analyze", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ online_id: onlineId }),
            });

            const data = await res.json();

            if (res.status === 401) {
                psnStatus.textContent = "Ø§Ù„Ø¬Ù„Ø³Ø© Ù…Ù†ØªÙ‡ÙŠØ©ØŒ Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©.";
                psnStatus.classList.add("error");
                return;
            }

            if (!res.ok || !data.ok) {
                psnStatus.textContent = data.message || "ØªØ¹Ø°Ø± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨.";
                psnStatus.classList.add("error");
                return;
            }

            psnStatus.textContent = "ØªÙ… ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­.";
            psnStatus.classList.add("success");

            fillPsnCards(data);
        } catch (err) {
            console.error(err);
            psnStatus.textContent = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„.";
            psnStatus.classList.add("error");
        } finally {
            analyzeBtn.disabled = false;
        }
    });

    function fillPsnCards(data) {
        const onlineId = data.online_id || psnIdInput.value || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
        const regionPretty = data.region_pretty || data.region || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©";
        const presence = data.presence || "ØºÙŠØ± Ø¸Ø§Ù‡Ø± (ØºØ§Ù„Ø¨Ù‹Ø§ Ù…Ø®ÙÙŠ/Ø£ÙˆÙÙ„Ø§ÙŠÙ†)";
        const valueSegment = data.value_segment || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
        const activitySegment = data.activity_segment || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
        const riskLevel = data.risk_level || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
        const titlesCount = data.titles_count ?? "ØºÙŠØ± Ù…ØªÙˆÙØ±";
        const friendsTotal = data.friends_total ?? "ØºÙŠØ± Ù…ØªÙˆÙØ± (Ù‚Ø§Ø¦Ù…Ø© Ø£ØµØ¯Ù‚Ø§Ø¡ Ø®Ø§ØµØ©ØŸ)";
        const friendsOnlineEst = data.friends_online_est ?? "ØºÙŠØ± Ù…ØªÙˆÙØ±";
        const avatarUrl = data.avatar_url || "N/A";

        const trophies = data.trophies || {};
        const lvl = trophies.level ?? "ØºÙŠØ± Ù…ØªÙˆÙØ±";
        const total = trophies.total ?? "ØºÙŠØ± Ù…ØªÙˆÙØ±";
        const pt = trophies.platinum ?? 0;
        const gd = trophies.gold ?? 0;
        const sv = trophies.silver ?? 0;
        const br = trophies.bronze ?? 0;

        const currentTitle = data.current_title || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù„Ø¹Ø¨Ø© Ø­Ø§Ù„ÙŠØ© Ø£Ùˆ Ù…Ø®ÙÙŠØ©";

        const trophySummary = data.trophy_summary || "Ù„Ù… ÙŠØªÙ… ØªÙˆÙÙŠØ± Ù…Ù„Ø®Øµ Ù…Ù† Ø³ÙˆÙ†ÙŠ.";

        // Ø§Ù„Ù…Ù„Ø®Øµ
        psnOnlineId.textContent = onlineId;
        psnRegionTag.textContent = "Ø§Ù„Ù…Ù†Ø·Ù‚Ø©: " + regionPretty;
        psnValueSegment.textContent = valueSegment;
        psnActivitySegment.textContent = activitySegment;

        // Ù„ÙˆÙ† Ø§Ù„Ù…Ø®Ø§Ø·Ø±
        psnRiskTag.textContent = riskLevel;
        psnRiskTag.className = "tag";
        const risk = (riskLevel || "").toString();
        if (risk.includes("Ù…Ù†Ø®ÙØ¶")) {
            psnRiskTag.classList.add("tag-green");
        } else if (risk.includes("Ù…ØªÙˆØ³Ø·")) {
            psnRiskTag.classList.add("tag-yellow");
        } else if (risk.includes("Ø¹Ø§Ù„ÙŠ") || risk.includes("Ù…Ø±ØªÙØ¹")) {
            psnRiskTag.classList.add("tag-red");
        }

        // Ø¬Ù…Ù„Ø© ÙŠØ³ØªØ§Ù‡Ù„ ÙˆÙ„Ø§ Ù„Ø§ (Ù†ÙØ³ Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¨Ø§Ùƒ)
        let worthLine;
        if (valueSegment.includes("Ø¹Ø§Ù„ÙŠ")) {
            worthLine = "Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: Ø§Ù„Ø­Ø³Ø§Ø¨ ÙŠØ³ØªØ§Ù‡Ù„ ØªØ¹Ø¨ Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹ØŒ Ø§Ø¹ØªØ¨Ø±Ù‡ Ù…Ù† Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù‚ÙˆÙŠØ©.";
        } else if (valueSegment.includes("Ù…ØªÙˆØ³Ø·")) {
            worthLine = "Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø·ØŒ Ù…Ù†Ø§Ø³Ø¨ Ù„Ø¹Ø±ÙˆØ¶ Ø³Ø¹Ø± Ù…ØªÙˆØ³Ø·Ø©ØŒ Ù…Ùˆ Ù†Ø§Ø¯Ø± ÙˆÙ„Ø§ Ø¶Ø¹ÙŠÙ.";
        } else {
            worthLine = "Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: Ø­Ø³Ø§Ø¨ Ù‚ÙŠÙ…ØªÙ‡ Ø¶Ø¹ÙŠÙØ©ØŒ Ù„Ø§ ØªØ¨Ø§Ù„Øº Ù…Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙÙŠ Ø§Ù„ÙˆØ¹ÙˆØ¯ Ø£Ùˆ Ø§Ù„Ø³Ø¹Ø±.";
        }
        psnWorthLine.textContent = worthLine;

        // Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨
        psnPresence.textContent = presence;
        psnCurrentTitle.textContent = currentTitle;

        // Ø§Ù„ØªØ±ÙˆÙÙŠØ²
        psnTrophySummary.textContent = trophySummary;
        psnTrophyLevel.textContent = lvl;
        psnTrophyTotal.textContent = total;
        psnTrophyPlat.textContent = pt;
        psnTrophyGold.textContent = gd;
        psnTrophySilver.textContent = sv;
        psnTrophyBronze.textContent = br;

        // Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ ÙˆØ§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡
        psnTitlesCount.textContent = titlesCount;
        psnFriendsTotal.textContent = friendsTotal;
        psnFriendsOnline.textContent = friendsOnlineEst;

        // Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©
        const riskFlags = data.risk_flags || [];
        if (riskFlags.length === 0) {
            psnRiskFlags.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø®Ø§Ø·Ø± Ø¥Ø¶Ø§ÙÙŠØ©.";
        } else {
            psnRiskFlags.innerHTML = riskFlags
                .map(f => "â€¢ " + (f || ""))
                .join("<br>");
        }

        // Ø§Ù„Ø£ÙØ§ØªØ§Ø±
        psnAvatarUrl.textContent = avatarUrl;
        if (avatarUrl && avatarUrl !== "N/A") {
            psnAvatarImg.src = avatarUrl;
            psnAvatarImg.style.display = "block";
        } else {
            psnAvatarImg.style.display = "none";
        }

        // Ø§Ù„Ù†ØµÙˆØµ Ù…Ù† Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯
        internalReportTextarea.value = data.message || "";
        clientMessageTextarea.value = data.client_message || "";
    }

    // Ø²Ø± Ù†Ø³Ø® Ù†Øµ Ø§Ù„Ø¹Ù…ÙŠÙ„
    copyClientMessageBtn.addEventListener("click", async () => {
        copyStatus.textContent = "";
        copyStatus.className = "status-text text-xs";

        const txt = clientMessageTextarea.value || "";
        if (!txt.trim()) {
            copyStatus.textContent = "Ù…Ø§ ÙÙŠÙ‡ Ù†Øµ Ø¬Ø§Ù‡Ø² Ù„Ù„Ù†Ø³Ø®.";
            copyStatus.classList.add("error");
            return;
        }

        try {
            await navigator.clipboard.writeText(txt);
            copyStatus.textContent = "ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ù„Ù„Ø°Ø§ÙƒØ±Ø©.";
            copyStatus.classList.add("success");
        } catch (e) {
            copyStatus.textContent = "ØªØ¹Ø°Ø± Ø§Ù„Ù†Ø³Ø® ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ØŒ Ø§Ù†Ø³Ø® ÙŠØ¯ÙˆÙŠÙ‹Ø§.";
            copyStatus.classList.add("error");
        }
    });
</script>
</body>
</html>
