<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>DEMAN Panel â€“ Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Ø®Ø· Tajawal -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  >

  <style>
    :root {
      --bg-main: #020617;
      --bg-main-light: #e5edff;
      --bg-card-dark: #020617;
      --bg-card-light: #f8fafc;
      --border-soft-dark: rgba(51,65,85,0.9);
      --border-soft-light: rgba(148,163,184,0.9);
      --primary: #3b82f6;
      --primary-2: #6366f1;
      --accent: #22d3ee;
      --accent-soft: rgba(34,211,238,0.25);
      --text-main-dark: #e5e7eb;
      --text-main-light: #0f172a;
      --muted-dark: #9ca3af;
      --muted-light: #6b7280;
      --radius-lg: 22px;
      --radius-md: 14px;
      --shadow-soft-dark: 0 28px 80px rgba(15,23,42,0.95);
      --shadow-soft-light: 0 18px 50px rgba(148,163,184,0.35);
      --transition: 0.25s ease;
    }

    * {
      box-sizing: border-box;
      font-family: "Tajawal", system-ui, -apple-system, BlinkMacSystemFont,
      "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
      background:
        radial-gradient(circle at 10% -10%, #1d4ed8 0, transparent 55%),
        radial-gradient(circle at 90% 110%, #0ea5e9 0, transparent 55%),
        var(--bg-main);
      color: var(--text-main-dark);
      overflow-x: hidden;
      transition: background var(--transition), color var(--transition);
    }

    body.light {
      background:
        radial-gradient(circle at 10% -10%, #c7d2fe 0, transparent 55%),
        radial-gradient(circle at 90% 110%, #bae6fd 0, transparent 55%),
        var(--bg-main-light);
      color: var(--text-main-light);
    }

    .ps-bg {
      position: fixed;
      inset: -80px;
      overflow: hidden;
      pointer-events: none;
      z-index: 0;
    }

    .ps-shape {
      position: absolute;
      font-size: 90px;
      font-weight: 600;
      color: rgba(148,163,184,0.18);
      text-shadow: 0 0 40px rgba(15,23,42,0.9);
      filter: blur(0.3px);
      animation-duration: 24s;
      animation-iteration-count: infinite;
      animation-timing-function: ease-in-out;
      animation-direction: alternate;
    }

    .ps-triangle {
      top: 8%;
      right: 12%;
      animation-name: float1;
      color: rgba(94,234,212,0.25);
    }

    .ps-square {
      bottom: 10%;
      left: 15%;
      animation-name: float2;
      color: rgba(129,140,248,0.30);
    }

    .ps-cross {
      top: 20%;
      left: 5%;
      animation-name: float3;
      color: rgba(248,113,113,0.25);
    }

    .ps-circle {
      bottom: 6%;
      right: 20%;
      animation-name: float4;
      color: rgba(56,189,248,0.30);
    }

    @keyframes float1 {
      0% { transform: translate3d(0,0,0) rotate(0deg) scale(1); }
      50% { transform: translate3d(12px, -25px,0) rotate(10deg) scale(1.08); }
      100% { transform: translate3d(-18px, 10px,0) rotate(-8deg) scale(1.02); }
    }

    @keyframes float2 {
      0% { transform: translate3d(0,0,0) rotate(12deg) scale(1); }
      50% { transform: translate3d(-25px, 25px,0) rotate(0deg) scale(1.12); }
      100% { transform: translate3d(15px,-15px,0) rotate(-10deg) scale(1.04); }
    }

    @keyframes float3 {
      0% { transform: translate3d(0,0,0) rotate(-12deg) scale(0.9); }
      50% { transform: translate3d(20px,20px,0) rotate(5deg) scale(1.05); }
      100% { transform: translate3d(-10px,-15px,0) rotate(15deg) scale(1); }
    }

    @keyframes float4 {
      0% { transform: translate3d(0,0,0) scale(1); }
      50% { transform: translate3d(-15px,-25px,0) scale(1.12); }
      100% { transform: translate3d(20px,10px,0) scale(1.02); }
    }

    .hidden { display: none !important; }

    .auth-wrapper {
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 480px;
      margin: auto;
      padding: 40px 16px 20px;
    }

    .logo-pill {
      width: 64px;
      height: 64px;
      border-radius: 20px;
      background:
        radial-gradient(circle at 30% 20%, #22d3ee, transparent 55%),
        radial-gradient(circle at 70% 80%, #3b82f6, transparent 55%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 18px 40px rgba(15,23,42,0.9);
      margin: 0 auto 12px;
      border: 1px solid rgba(148,163,184,0.6);
      font-weight: 700;
      color: #e5e7eb;
      font-size: 1.1rem;
    }

    body.light .logo-pill {
      box-shadow: 0 14px 35px rgba(129,140,248,0.75);
    }

    .auth-card {
      background:
        radial-gradient(circle at top left, rgba(37,99,235,0.24), transparent 55%),
        radial-gradient(circle at bottom right, rgba(56,189,248,0.28), transparent 55%),
        var(--bg-card-dark);
      border-radius: 24px;
      padding: 22px 20px 18px;
      box-shadow: var(--shadow-soft-dark);
      border: 1px solid var(--border-soft-dark);
      position: relative;
      overflow: hidden;
    }

    body.light .auth-card {
      background:
        radial-gradient(circle at top left, rgba(37,99,235,0.15), transparent 55%),
        radial-gradient(circle at bottom right, rgba(56,189,248,0.18), transparent 55%),
        var(--bg-card-light);
      border-color: var(--border-soft-light);
      box-shadow: var(--shadow-soft-light);
    }

    .auth-card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0 0, rgba(59,130,246,0.35), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(14,165,233,0.4), transparent 55%);
      opacity: 0.15;
      pointer-events: none;
    }

    .auth-header {
      text-align: center;
      margin-bottom: 14px;
      position: relative;
      z-index: 1;
    }

    .auth-title {
      font-size: 1.15rem;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .auth-sub {
      font-size: 0.86rem;
      color: var(--muted-dark);
    }

    body.light .auth-sub {
      color: var(--muted-light);
    }

    .auth-sub strong {
      color: #e5e7eb;
    }

    body.light .auth-sub strong {
      color: #0f172a;
    }

    .form-group {
      position: relative;
      margin-bottom: 12px;
      font-size: 0.82rem;
      text-align: right;
      z-index: 1;
    }

    label {
      display: block;
      margin-bottom: 4px;
      color: var(--muted-dark);
    }

    body.light label {
      color: var(--muted-light);
    }

    input[type="email"],
    input[type="password"],
    input[type="text"],
    input[type="number"],
    textarea,
    select {
      width: 100%;
      padding: 9px 11px;
      border-radius: 12px;
      border: 1px solid rgba(71,85,105,0.95);
      background: rgba(15,23,42,0.96);
      color: var(--text-main-dark);
      font-size: 0.9rem;
      outline: none;
      transition:
        border var(--transition),
        box-shadow var(--transition),
        background var(--transition),
        transform 0.08s ease,
        color var(--transition);
    }

    body.light input,
    body.light textarea,
    body.light select {
      background: #f9fafb;
      color: var(--text-main-light);
      border-color: rgba(148,163,184,0.9);
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(34,211,238,0.45);
      transform: translateY(-1px);
    }

    textarea {
      resize: vertical;
      min-height: 70px;
    }

    .password-wrapper {
      position: relative;
    }

    .toggle-password {
      position: absolute;
      top: 50%;
      left: 8px;
      transform: translateY(-50%);
      font-size: 0.75rem;
      padding: 3px 10px;
      border-radius: 999px;
      border: 1px solid rgba(71,85,105,0.9);
      background: rgba(15,23,42,0.96);
      color: var(--muted-dark);
      cursor: pointer;
      transition:
        background var(--transition),
        color var(--transition),
        border var(--transition),
        transform 0.08s ease;
    }

    .toggle-password:hover {
      background: rgba(15,23,42,1);
      color: #e5e7eb;
      border-color: rgba(148,163,184,0.95);
    }

    body.light .toggle-password {
      background: #f9fafb;
      border-color: rgba(148,163,184,0.9);
      color: var(--muted-light);
    }

    body.light .toggle-password:hover {
      background: #e5edff;
      color: var(--text-main-light);
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 9px 16px;
      font-size: 0.9rem;
      cursor: pointer;
      transition:
        background var(--transition),
        box-shadow var(--transition),
        transform 0.08s ease,
        color var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn-primary {
      width: 100%;
      background: linear-gradient(135deg, var(--primary), var(--primary-2));
      color: white;
      box-shadow: 0 18px 40px rgba(37,99,235,0.9);
      margin-top: 4px;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 22px 55px rgba(37,99,235,1);
    }

    .btn-ghost {
      background: transparent;
      color: var(--muted-dark);
    }

    body.light .btn-ghost {
      color: var(--muted-light);
    }

    .btn-ghost:hover {
      color: #e5e7eb;
    }

    body.light .btn-ghost:hover {
      color: var(--text-main-light);
    }

    .auth-footer {
      margin-top: 10px;
      font-size: 0.78rem;
      color: var(--muted-dark);
      text-align: center;
      position: relative;
      z-index: 1;
    }

    body.light .auth-footer {
      color: var(--muted-light);
    }

    .pill-text {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 4px 12px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.96);
      font-size: 0.78rem;
      color: var(--muted-dark);
      gap: 4px;
      margin-top: 6px;
    }

    .pill-text strong {
      color: #e5e7eb;
      font-weight: 600;
    }

    body.light .pill-text {
      background: rgba(248,250,252,0.96);
      border-color: rgba(148,163,184,0.9);
      color: var(--muted-light);
    }

    body.light .pill-text strong {
      color: var(--text-main-light);
    }

    .contact-bar {
      margin-top: 10px;
      font-size: 0.78rem;
      color: var(--muted-dark);
      text-align: center;
    }

    body.light .contact-bar {
      color: var(--muted-light);
    }

    .contact-links {
      margin-top: 6px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 6px;
    }

    .contact-icon {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(71,85,105,0.9);
      background: rgba(15,23,42,0.95);
      color: #e5e7eb;
      font-size: 0.78rem;
      text-decoration: none;
    }

    .contact-icon span.icon-circle {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      background: rgba(37,99,235,0.9);
    }

    body.light .contact-icon {
      background: #f9fafb;
      border-color: rgba(148,163,184,0.9);
      color: #0f172a;
    }

    .view { display: none; }
    .view.active { display: block; }

    /* Dashboard shell */
    #dashboard {
      position: relative;
      z-index: 1;
      max-width: 1160px;
      margin: 16px auto 26px;
      padding: 0 10px 30px;
      display: none;
    }

    #dashboard.active { display: block; }

    .app-shell {
      border-radius: 24px;
      background: rgba(15,23,42,0.96);
      border: 1px solid rgba(51,65,85,0.95);
      box-shadow: var(--shadow-soft-dark);
      overflow: hidden;
      backdrop-filter: blur(18px);
    }

    body.light .app-shell {
      background: rgba(248,250,252,0.96);
      border-color: rgba(148,163,184,0.9);
      box-shadow: var(--shadow-soft-light);
    }

    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 16px;
      border-bottom: 1px solid rgba(51,65,85,0.9);
      background: linear-gradient(to left, rgba(15,23,42,1), rgba(15,23,42,0.85));
    }

    body.light .app-header {
      background: linear-gradient(to left, #e5edff, #f9fafb);
      border-color: rgba(148,163,184,0.8);
    }

    .app-title {
      font-size: 0.95rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .badge {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(56,189,248,0.15);
      color: #e0f2fe;
      border: 1px solid rgba(56,189,248,0.4);
    }

    body.light .badge {
      background: rgba(37,99,235,0.08);
      color: #1d4ed8;
      border-color: rgba(59,130,246,0.4);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 0;
    }

    .icon-btn {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      border: 1px solid rgba(71,85,105,0.95);
      background: rgba(15,23,42,0.96);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      cursor: pointer;
      transition:
        background var(--transition),
        transform 0.08s ease,
        border var(--transition),
        color var(--transition);
      color: #e5e7eb;
      flex-shrink: 0;
    }

    .icon-btn:active {
      transform: scale(0.96);
    }

    body.light .icon-btn {
      background: #f8fafc;
      border-color: rgba(148,163,184,0.9);
      color: #0f172a;
    }

    .profile-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding-inline: 10px;
      max-width: 180px;
    }

    .avatar {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      background:
        radial-gradient(circle at 20% 20%, #22d3ee, transparent 55%),
        radial-gradient(circle at 80% 80%, #6366f1, transparent 55%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      color: #e5e7eb;
      font-weight: 600;
      flex-shrink: 0;
      overflow: hidden;
    }

    .profile-name {
      font-size: 0.8rem;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .profile-menu {
      position: absolute;
      top: 54px;
      left: 18px;
      width: 240px;
      background: rgba(15,23,42,0.98);
      border-radius: var(--radius-md);
      border: 1px solid rgba(51,65,85,0.95);
      box-shadow: 0 20px 55px rgba(15,23,42,0.9);
      padding: 8px;
      font-size: 0.84rem;
      display: none;
      z-index: 50;
    }

    body.light .profile-menu {
      background: #f9fafb;
      border-color: rgba(148,163,184,0.9);
      box-shadow: var(--shadow-soft-light);
    }

    .profile-row {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 6px 8px;
    }

    .profile-row-main-text {
      font-size: 0.78rem;
      opacity: 0.85;
    }

    .profile-item {
      padding: 6px 8px;
      border-radius: 9px;
      cursor: pointer;
      margin-bottom: 4px;
      transition:
        background var(--transition),
        color var(--transition);
    }

    .profile-item:hover {
      background: rgba(30,64,175,0.9);
      color: #e5e7eb;
    }

    body.light .profile-item:hover {
      background: rgba(191,219,254,0.95);
      color: #0f172a;
    }

    .side-menu {
      position: fixed;
      top: 0;
      right: -260px;
      width: 260px;
      height: 100vh;
      background: rgba(15,23,42,0.98);
      color: #e5e7eb;
      box-shadow: -14px 0 30px rgba(15,23,42,0.9);
      padding: 16px 14px;
      display: flex;
      flex-direction: column;
      z-index: 60;
      transition: right var(--transition);
    }

    .side-menu.open {
      right: 0;
    }

    .side-title {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .side-item {
      padding: 8px 9px;
      border-radius: 10px;
      font-size: 0.88rem;
      cursor: pointer;
      margin-bottom: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition:
        background var(--transition),
        transform 0.08s ease;
    }

    .side-item-main {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .side-icon {
      width: 18px;
      height: 18px;
      border-radius: 5px;
      background: rgba(37,99,235,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
    }

    .side-item:hover {
      background: rgba(30,64,175,0.95);
      transform: translateX(-2px);
    }

    .side-footer {
      margin-top: auto;
      padding-top: 10px;
      border-top: 1px solid rgba(51,65,85,0.9);
      font-size: 0.8rem;
    }

    .theme-toggle {
      width: 100%;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(75,85,99,0.95);
      background: rgba(15,23,42,0.9);
      color: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      font-size: 0.8rem;
    }

    body.light .theme-toggle {
      background: #f9fafb;
      color: #0f172a;
      border-color: rgba(148,163,184,0.9);
    }

    .tabs {
      display: flex;
      gap: 8px;
      padding: 10px 16px 0;
      border-bottom: 1px solid rgba(51,65,85,0.9);
      background: rgba(15,23,42,0.96);
      overflow-x: auto;
    }

    body.light .tabs {
      background: rgba(248,250,252,0.96);
      border-color: rgba(148,163,184,0.8);
    }

    .tab {
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 0.82rem;
      cursor: pointer;
      border: 1px solid transparent;
      color: #9ca3af;
      white-space: nowrap;
    }

    body.light .tab {
      color: #6b7280;
    }

    .tab.active {
      background: var(--accent-soft);
      border-color: rgba(56,189,248,0.8);
      color: #e0f2fe;
    }

    body.light .tab.active {
      background: rgba(37,99,235,0.16);
      border-color: rgba(37,99,235,0.8);
      color: #1d4ed8;
    }

    .app-body {
      padding: 10px 16px 18px;
      background:
        radial-gradient(circle at top left, rgba(15,23,42,0.9), rgba(15,23,42,0.98));
    }

    body.light .app-body {
      background: linear-gradient(to bottom, #f9fafb, #e5edff);
    }

    .view-panel { display: none; }
    .view-panel.active { display: block; }

    .search-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
    }

    .search-input {
      flex: 1;
      min-width: 220px;
      padding: 9px 12px;
      border-radius: 999px;
      border: 1px solid rgba(71,85,105,0.9);
      background: rgba(15,23,42,0.96);
      color: var(--text-main-dark);
      font-size: 0.9rem;
      outline: none;
      transition:
        border var(--transition),
        box-shadow var(--transition),
        background var(--transition),
        color var(--transition);
    }

    body.light .search-input {
      background: #f9fafb;
      color: var(--text-main-light);
      border-color: rgba(148,163,184,0.9);
    }

    .search-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(34,211,238,0.4);
    }

    .btn-add {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #fff;
      padding-inline: 14px;
      box-shadow: 0 14px 30px rgba(22,163,74,0.6);
      border-radius: 999px;
      font-size: 0.85rem;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .info-chip {
      font-size: 0.78rem;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(148,163,184,0.17);
      color: #cbd5f5;
    }

    body.light .info-chip {
      background: rgba(148,163,184,0.25);
      color: #374151;
    }

    .grid-main {
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(260px, 1fr);
      gap: 14px;
      margin-top: 8px;
    }

    @media (max-width: 860px) {
      .grid-main {
        grid-template-columns: minmax(0,1fr);
      }
    }

    .card {
      background: rgba(15,23,42,0.96);
      border-radius: var(--radius-md);
      border: 1px solid rgba(51,65,85,0.95);
      padding: 10px 10px 8px;
      font-size: 0.85rem;
      box-shadow: 0 18px 45px rgba(15,23,42,0.9);
    }

    body.light .card {
      background: rgba(248,250,252,0.96);
      border-color: rgba(148,163,184,0.9);
      box-shadow: var(--shadow-soft-light);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
    }

    .card-title {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .card-sub {
      font-size: 0.78rem;
      opacity: 0.78;
    }

    .list {
      max-height: 340px;
      overflow: auto;
      padding-inline-end: 2px;
    }

    .list-item {
      border-radius: 10px;
      border: 1px solid rgba(71,85,105,0.9);
      padding: 7px 8px;
      margin-bottom: 5px;
      cursor: pointer;
      transition:
        background var(--transition),
        border var(--transition),
        transform 0.08s ease;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .list-item:hover {
      background: rgba(59,130,246,0.12);
      border-color: rgba(59,130,246,0.9);
      transform: translateY(-1px);
    }

    body.light .list-item {
      border-color: rgba(148,163,184,0.9);
    }

    body.light .list-item:hover {
      background: rgba(191,219,254,0.7);
    }

    .list-row-main {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.86rem;
    }

    .list-id {
      font-weight: 600;
    }

    .status-chip {
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(22,163,74,0.18);
      color: #bbf7d0;
    }

    .status-pending {
      background: rgba(234,179,8,0.2);
      color: #fef3c7;
    }

    .status-rejected {
      background: rgba(239,68,68,0.2);
      color: #fecaca;
    }

    body.light .status-chip {
      background: rgba(22,163,74,0.12);
      color: #166534;
    }

    body.light .status-pending {
      background: rgba(250,204,21,0.18);
      color: #854d0e;
    }

    body.light .status-rejected {
      background: rgba(248,113,113,0.2);
      color: #b91c1c;
    }

    .meta-row {
      font-size: 0.76rem;
      opacity: 0.82;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .recent-list {
      max-height: 340px;
      overflow: auto;
      padding-inline-end: 2px;
    }

    .recent-item {
      border-radius: 10px;
      border: 1px dashed rgba(71,85,105,0.9);
      padding: 6px 7px;
      margin-bottom: 4px;
      font-size: 0.78rem;
      display: flex;
      flex-direction: column;
      gap: 2px;
      cursor: pointer;
      transition:
        background var(--transition),
        transform 0.08s ease;
    }

    .recent-item:hover {
      background: rgba(59,130,246,0.15);
      transform: translateY(-1px);
    }

    body.light .recent-item {
      border-color: rgba(148,163,184,0.9);
    }

    .recent-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .pill {
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(148,163,184,0.25);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
    }

    th, td {
      text-align: right;
      padding: 5px 4px;
      border-bottom: 1px solid rgba(51,65,85,0.9);
      font-size: 0.8rem;
    }

    body.light th,
    body.light td {
      border-color: rgba(148,163,184,0.8);
    }

    /* Modals */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 80;
    }

    .modal {
      width: min(480px, 94vw);
      background: rgba(15,23,42,0.98);
      border-radius: 20px;
      border: 1px solid rgba(51,65,85,0.95);
      box-shadow: 0 26px 80px rgba(15,23,42,0.95);
      padding: 14px 14px 10px;
      font-size: 0.85rem;
    }

    body.light .modal {
      background: #f9fafb;
      border-color: rgba(148,163,184,0.9);
      box-shadow: var(--shadow-soft-light);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .modal-title {
      font-weight: 600;
      font-size: 0.9rem;
    }

    .modal-body {
      max-height: 440px;
      overflow: auto;
      padding-inline-end: 2px;
    }

    .modal-footer {
      margin-top: 10px;
      display: flex;
      justify-content: flex-end;
      gap: 6px;
    }

    .text-note {
      font-size: 0.78rem;
      opacity: 0.85;
      margin-top: 4px;
    }

    /* Profile layout */
    .profile-layout {
      display: grid;
      grid-template-columns: minmax(260px, 0.95fr) minmax(0, 1.4fr);
      gap: 14px;
      align-items: flex-start;
    }

    @media (max-width: 880px) {
      .profile-layout {
        grid-template-columns: minmax(0,1fr);
      }
    }

    .profile-main-card {
      text-align: center;
      padding-top: 16px;
      padding-bottom: 16px;
    }

    .profile-avatar-big {
      width: 96px;
      height: 96px;
      border-radius: 999px;
      margin: 0 auto 10px;
      background:
        radial-gradient(circle at 20% 20%, #22d3ee, transparent 55%),
        radial-gradient(circle at 80% 80%, #6366f1, transparent 55%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
      font-weight: 700;
      color: #e5e7eb;
      overflow: hidden;
    }

    .profile-main-name {
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .profile-main-title {
      font-size: 0.8rem;
      opacity: 0.85;
      margin-bottom: 8px;
    }

    .profile-main-meta {
      font-size: 0.78rem;
      opacity: 0.9;
      display: flex;
      flex-direction: column;
      gap: 4px;
      align-items: center;
    }

    .profile-fields-card .form-group {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
<div class="ps-bg">
  <div class="ps-shape ps-triangle">â–³</div>
  <div class="ps-shape ps-square">â˜</div>
  <div class="ps-shape ps-cross">âœ•</div>
  <div class="ps-shape ps-circle">â­˜</div>
</div>

<!-- ===== AUTH AREA ===== -->
<section id="authSection" class="auth-wrapper">
  <div class="logo-pill">DT</div>

  <div class="auth-card">
    <!-- Ø®Ø·ÙˆØ© Ø§Ù„Ø¨Ø±ÙŠØ¯ + ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
    <div id="view-login" class="view active">
      <div class="auth-header">
        <div class="auth-title">Ù…Ù†ÙˆÙ‘Ø± ÙŠØ§ Ø¨Ø·Ù„ ğŸ”</div>
        <div class="auth-sub">
          Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø¸ÙˆÙ…Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ ÙÙ‚Ø· Ù„ÙØ±ÙŠÙ‚
          <strong>DEMAN Team</strong>
        </div>
      </div>

      <form id="loginForm">
        <div class="form-group">
          <label for="loginEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label>
          <input type="email" id="loginEmail" placeholder="team@deman.store" required>
        </div>
        <div class="form-group">
          <label for="loginPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
          <div class="password-wrapper">
            <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
            <button type="button" class="toggle-password" data-target="loginPassword">Ø¹Ø±Ø¶</button>
          </div>
        </div>
        <button type="submit" class="btn btn-primary">Ø§Ø³ØªÙ…Ø±Ø§Ø±</button>
      </form>

      <div class="auth-footer">
        <div class="pill-text">
          Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø³Ù…ÙˆØ­ ÙÙ‚Ø· Ù„ÙØ±ÙŠÙ‚ <strong>DEMAN.STORE</strong> â€“ Ø£ÙŠ ÙˆØµÙˆÙ„ ØºÙŠØ±
          Ù…ØµØ±Ù‘Ø­ Ø¨Ù‡ Ø³ÙŠØªÙ… ØªØ¬Ø§Ù‡Ù„Ù‡.
        </div>
      </div>
    </div>

    <!-- Ø®Ø·ÙˆØ© ÙƒÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ -->
    <div id="view-email-code" class="view">
      <div class="auth-header">
        <div class="auth-title">ØªØ£ÙƒÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø±Ù…Ø² Ø¹Ù„Ù‰ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ âœ‰ï¸</div>
        <div class="auth-sub">
          ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ù…ÙƒÙˆÙ‘Ù† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù… Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ
          <strong id="emailLabel">Ø§Ù„Ù…Ø³Ø¬Ù‘Ù„ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</strong>
        </div>
      </div>

      <form id="emailCodeForm">
        <div class="form-group">
          <label for="emailCodeInput">Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯</label>
          <input
            type="text"
            id="emailCodeInput"
            maxlength="6"
            inputmode="numeric"
            placeholder="Ù…Ø«Ø§Ù„: 123456"
            required
          >
        </div>

        <!-- Ø®Ø§Ù†Ø© ØªØ°ÙƒÙ‘Ø± Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² -->
        <div class="form-group" style="margin-top:6px;">
          <label style="display:flex;align-items:center;gap:6px;font-size:0.78rem;margin-bottom:0;">
            <input
              type="checkbox"
              id="rememberDevice"
              style="width:auto;accent-color:#3b82f6;"
            >
            <span>ØªØ°ÙƒÙ‘Ø± Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² (Ø¹Ø¯Ù… Ø·Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ù…Ø±Ø§Øª Ø§Ù„Ø¬Ø§ÙŠØ©)</span>
          </label>
          <div class="text-note">
            Ù„Ø§ ØªÙØ¹Ù‘ÙÙ„ Ø§Ù„Ø®ÙŠØ§Ø± Ø¹Ù„Ù‰ Ø£Ø¬Ù‡Ø²Ø© Ù…Ø´ØªØ±ÙƒØ© Ø£Ùˆ Ø£Ø¬Ù‡Ø²Ø© Ù…Ù‚Ø§Ù‡ÙŠ.
          </div>
        </div>

        <button type="submit" class="btn btn-primary">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      </form>

      <div class="auth-footer">
        <button id="backToLoginBtn" class="btn btn-ghost" type="button">
          Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø±ÙŠØ¯ / ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        </button>
        <div class="pill-text" style="margin-top:6px;">
          ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† Ø§Ù„Ø¨Ø§ÙƒÙ†Ø¯ ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…Ø³Ø¬Ù‘Ù„.
        </div>
      </div>
    </div>
  </div>

  <div class="contact-bar">
    <div>Ù„Ùˆ ØªØ­ØªØ§Ø¬ Ø¯Ø¹Ù… Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:</div>
    <div class="contact-links">
      <a href="https://wa.me/966571330193" target="_blank" class="contact-icon">
        <span class="icon-circle">WA</span><span>ÙˆØ§ØªØ³Ø§Ø¨</span>
      </a>

      <!-- Ø²Ø± Ø£Ø¯Ø§Ø© ØªØ­Ù„ÙŠÙ„ Ø­Ø³Ø§Ø¨ PSN Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ -->
      <button type="button" id="openPsnPanelFromFooter" class="contact-icon">
        <span class="icon-circle">PS</span><span>Ø£Ø¯Ø§Ø© ØªØ­Ù„ÙŠÙ„ Ø­Ø³Ø§Ø¨ PSN</span>
      </button>

      <a href="https://instagram.com/deman.store" target="_blank" class="contact-icon">
        <span class="icon-circle">IG</span><span>Ø¥Ù†Ø³ØªÙ‚Ø±Ø§Ù…</span>
      </a>
      <a href="tel:0571330193" class="contact-icon">
        <span class="icon-circle">ğŸ“</span><span>Ø§ØªØµØ§Ù„</span>
      </a>
    </div>
  </div>
</section>

<!-- ===== DASHBOARD ===== -->
<section id="dashboard">
  <div class="app-shell">
    <header class="app-header">
      <div class="app-title">
        Ø¥Ø¯Ø§Ø±Ø© Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
        <span class="badge">DEMAN Panel</span>
      </div>
      <div class="header-right">
        <button id="menuToggle" class="icon-btn" title="Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ø²ÙŠØ¯">â˜°</button>
        <button id="profileBtn" class="icon-btn profile-btn" title="Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ¸Ù">
          <div id="headerAvatar" class="avatar">DT</div>
          <span id="profileNameLabel" class="profile-name">DEMAN Team</span>
        </button>
      </div>

      <div id="profileMenu" class="profile-menu">
        <div class="profile-row">
          <div class="avatar" id="profileMenuAvatar">DT</div>
          <div>
            <div id="profileMenuName" style="font-weight:600;font-size:0.85rem;">
              DEMAN Team
            </div>
            <div class="profile-row-main-text" id="profileMenuPhone">
              Ø¨Ø¯ÙˆÙ† Ø±Ù‚Ù… Ù…ÙˆØ«Ù‘ÙÙ‚ Ø¨Ø¹Ø¯
            </div>
          </div>
        </div>
        <div id="manageAccountItem" class="profile-item">
          Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ / Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ¸Ù
        </div>
        <div id="logoutItem" class="profile-item" style="color:#fca5a5;">
          ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        </div>
      </div>
    </header>

    <aside id="sideMenu" class="side-menu">
      <div class="side-title">Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„</div>

      <div class="side-item" data-view="main">
        <div class="side-item-main">
          <div class="side-icon">ID</div>
          <span>Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©</span>
        </div>
        <small>Ø¹Ø±Ø¶ / ØªØ¹Ø¯ÙŠÙ„</small>
      </div>

      <div class="side-item" data-view="payments">
        <div class="side-item-main">
          <div class="side-icon">ï·¼</div>
          <span>Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</span>
        </div>
        <small>Ø¬Ø¯ÙˆÙ„ + ØªÙ‚Ø³ÙŠÙ…</small>
      </div>

      <div class="side-item" data-view="tools">
        <div class="side-item-main">
          <div class="side-icon">âš™</div>
          <span>Ø§Ù„Ø£Ø¯ÙˆØ§Øª</span>
        </div>
        <small>Ø¨Ù†ÙˆØ¯ / Ø£Ø³Ø¹Ø§Ø±</small>
      </div>

      <div class="side-item" data-view="info">
        <div class="side-item-main">
          <div class="side-icon">ğŸ“</div>
          <span>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</span>
        </div>
        <small>Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø§Ù‡Ø²</small>
      </div>

      <div class="side-item" data-view="psn">
        <div class="side-item-main">
          <div class="side-icon">ğŸ®</div>
          <span>ØªØ­Ù„ÙŠÙ„ Ø­Ø³Ø§Ø¨ PSN</span>
        </div>
        <small>ØªØ±ÙˆÙÙŠØ² / Ø±ÙŠØ¬Ù† / Ù†Ø´Ø§Ø·</small>
      </div>

      <div class="side-item" data-view="profile">
        <div class="side-item-main">
          <div class="side-icon">ğŸ‘¤</div>
          <span>Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ¸Ù</span>
        </div>
        <small>Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</small>
      </div>

      <div class="side-footer">
        <button id="themeToggle" class="theme-toggle">
          <span>ØªØºÙŠÙŠØ± Ø§Ù„Ø«ÙŠÙ…</span>
          <span id="themeLabel">Ø¯Ø§ÙƒÙ†</span>
        </button>
      </div>
    </aside>

    <nav class="tabs">
      <div class="tab active" data-view="main">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
      <div class="tab" data-view="payments">Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</div>
      <div class="tab" data-view="tools">Ø§Ù„Ø£Ø¯ÙˆØ§Øª</div>
      <div class="tab" data-view="info">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
      <div class="tab" data-view="psn">ØªØ­Ù„ÙŠÙ„ Ø­Ø³Ø§Ø¨ PSN</div>
      <div class="tab" data-view="profile">Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ¸Ù</div>
    </nav>

    <main class="app-body">
      <!-- MAIN -->
      <section id="panel-main" class="view-panel active">
        <div class="search-row">
          <input
            id="searchInput"
            class="search-input"
            type="text"
            placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ù€ ID Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯..."
          >
          <button id="addAccountBtn" class="btn-add">
            <span>ï¼‹</span> Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
          </button>
          <span id="resultsChip" class="info-chip">0 Ø­Ø³Ø§Ø¨Ø§Øª</span>
        </div>

        <div class="grid-main">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
                <div class="card-sub">
                  Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø³ÙˆÙ†ÙŠ â€“ Ø¨Ø­Ø«ØŒ Ø¹Ø±Ø¶ØŒ ØªØ¹Ø¯ÙŠÙ„ ÙˆØ¥Ø¶Ø§ÙØ©
                </div>
              </div>
            </div>
            <div id="accountsList" class="list"></div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø®ÙŠØ±</div>
                <div class="card-sub">
                  Ø£Ø­Ø¯Ø« Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª (ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ© Ù„Ù„ØªÙØ§ØµÙŠÙ„)
                </div>
              </div>
            </div>
            <div id="recentList" class="recent-list"></div>
          </div>
        </div>
      </section>

      <!-- PAYMENTS -->
      <section id="panel-payments" class="view-panel">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</div>
              <div class="card-sub">
                Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¨Ø§Ù„Øº ÙˆØªÙ‚Ø³ÙŠÙ…Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¨ÙŠÙ† Ø®Ø§Ù„Ø¯ (60Ùª) ÙˆØ¹Ø¨Ø¯Ø§Ù„ÙØªØ§Ø­ (40Ùª)
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="paymentInput">Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº (Ø±ÙŠØ§Ù„)</label>
            <input type="number" id="paymentInput" min="0" placeholder="Ù…Ø«Ø§Ù„: 100">
          </div>

          <button id="addPaymentBtn" class="btn btn-primary" style="width:auto;">
            Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø¬Ø¯ÙˆÙ„
          </button>

          <div style="margin-top:12px;overflow:auto;">
            <table>
              <thead>
              <tr>
                <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙƒÙ„ÙŠ</th>
                <th>Ø®Ø§Ù„Ø¯ 60Ùª</th>
                <th>Ø¹Ø¨Ø¯Ø§Ù„ÙØªØ§Ø­ 40Ùª</th>
                <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
              </tr>
              </thead>
              <tbody id="paymentsTableBody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- TOOLS -->
      <section id="panel-tools" class="view-panel">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Ø§Ù„Ø£Ø¯ÙˆØ§Øª</div>
              <div class="card-sub">
                Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹ â€“ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± â€“ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ â€“ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="toolsText">Ù†Øµ Ø§Ù„Ø£Ø¯ÙˆØ§Øª / Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª</label>
            <textarea
              id="toolsText"
              placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§ Ø¨Ù†Ø¯ Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹ØŒ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±ØŒ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ØŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ..."
            ></textarea>
            <div class="text-note">
              ÙƒÙ„ Ù…Ø§ ØªØ­ÙØ¸ Ù‡Ù†Ø§ ÙŠØªÙ… ØªØ®Ø²ÙŠÙ†Ù‡ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙˆÙŠØ¸Ù‡Ø± ÙƒÙ„ Ù…Ø±Ø© ØªÙØªØ­ Ø§Ù„Ù…Ù†Ø¸ÙˆÙ…Ø© Ù…Ù† Ù†ÙØ³ Ø§Ù„Ù…ØªØµÙØ­.
            </div>
          </div>

          <button id="saveToolsBtn" class="btn btn-primary" style="width:auto;">
            Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
          </button>
        </div>
      </section>

      <!-- INFO TEMPLATE -->
      <section id="panel-info" class="view-panel">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª â€“ Ù†Ù…ÙˆØ°Ø¬ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„</div>
              <div class="card-sub">
                Ø¹Ø¨Ù‘Ø¦ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø«Ù… Ø§Ø¶ØºØ· "ØªÙˆÙ„ÙŠØ¯ ÙˆÙ†Ø³Ø® Ø§Ù„Ù†Øµ" Ù„Ø¥Ø±Ø³Ø§Ù„Ù‡ Ù„Ù„Ø¹Ù…ÙŠÙ„ ÙÙŠ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ / Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="infoId">Ø§Ù„Ø§ÙŠØ¯ÙŠ</label>
            <input type="text" id="infoId" placeholder="Nickname123">
          </div>

          <div class="form-group">
            <label for="infoInfo">Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ</label>
            <textarea
              id="infoInfo"
              placeholder="Ù…Ø«Ø§Ù„: Ø¯ÙˆÙ„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ØŒ Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²ØŒ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ø§Ù…Ø© Ø¹Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„"
            ></textarea>
          </div>

          <div class="form-group">
            <label for="infoEmail">Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</label>
            <input type="text" id="infoEmail" placeholder="example@mail.com">
          </div>

          <div class="form-group">
            <label for="infoPassword">Ø§Ù„Ø¨Ø§Ø³ÙˆÙˆØ±Ø¯</label>
            <input type="text" id="infoPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¤Ù‚ØªØ© / Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
          </div>

          <div class="text-note">
            Ø£Ø³ÙÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù†Øµ Ø«Ø§Ø¨Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹:
            "Ù†Ù†ØµØ­Ùƒ Ø¨ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØ§Ù„Ø¨Ø±ÙŠØ¯ ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬ ÙˆØ¹Ø¯Ù… Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø­Ø³Ø§Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)..."
          </div>

          <button
            id="buildInfoBtn"
            class="btn btn-primary"
            style="width:auto;margin-top:10px;"
          >
            ØªÙˆÙ„ÙŠØ¯ ÙˆÙ†Ø³Ø® Ø§Ù„Ù†Øµ
          </button>

          <div class="form-group" style="margin-top:10px;">
            <label>Ø§Ù„Ù†Øµ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©)</label>
            <textarea id="infoPreview" readonly></textarea>
          </div>
        </div>
      </section>

      <!-- PSN ANALYZER -->
      <section id="panel-psn" class="view-panel">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">ØªØ­Ù„ÙŠÙ„ Ø­Ø³Ø§Ø¨ PSN</div>
              <div class="card-sub">
                Ø£Ø¯Ø®Ù„ Ø§Ù„Ø£ÙŠØ¯ÙŠ (ID) Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØªØ¬Ù‡ÙŠØ² Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù‚Ø¨Ù„ ÙØªØ­ Ù…Ù„Ù Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹.
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="psnIdInput">Ø§Ù„Ø£ÙŠØ¯ÙŠ (ID) ÙÙŠ Ø³ÙˆÙ†ÙŠ</label>
            <input
              type="text"
              id="psnIdInput"
              placeholder="Ù…Ø«Ø§Ù„: KingDeman_123"
            >
          </div>

          <button
            id="psnAnalyzeBtn"
            class="btn btn-primary"
            style="width:auto;margin-top:4px;"
          >
            ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¢Ù†
          </button>

          <div class="text-note">
            Ø§Ù„Ø²Ø± ÙŠØªØµÙ„ Ø¨Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ Flask Ø¹Ù†Ø¯Ùƒ (Ù…Ø«Ù„Ø§Ù‹ <code>/api/psn-analyze</code>)
            ÙˆÙŠØ¬ÙŠØ¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ±ÙˆÙÙŠØ² ÙˆØ§Ù„Ø±ÙŠØ¬Ù† ÙˆØ¢Ø®Ø± Ù†Ø´Ø§Ø·ØŒ ÙˆØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø¨Ø´ÙƒÙ„ Ù…Ù†Ø¸Ù….
          </div>

          <div class="form-group" style="margin-top:12px;">
            <label>Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„</label>
            <textarea
              id="psnResultBox"
              readonly
              placeholder="Ù‡Ù†Ø§ ØªØ¸Ù‡Ø± Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„: Ø§Ù„Ø±Ø¬Ù†ØŒ Ø¹Ø¯Ø¯ Ø§Ù„ØªØ±ÙˆÙÙŠØ²ØŒ Ø¢Ø®Ø± Ù„Ø¹Ø¨Ø©ØŒ Ù…Ù„Ø§Ø­Ø¸Ø§Øª..."
            ></textarea>
          </div>
        </div>
      </section>

      <!-- PROFILE -->
      <section id="panel-profile" class="view-panel">
        <div class="profile-layout">
          <div class="card profile-main-card">
            <div id="profileAvatarBig" class="profile-avatar-big">DT</div>
            <div id="profileCardName" class="profile-main-name">DEMAN Team</div>
            <div id="profileCardTitle" class="profile-main-title">
              Ø£Ø®ØµØ§Ø¦ÙŠ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø­Ø³Ø§Ø¨Ø§Øª
            </div>
            <div class="profile-main-meta">
              <span id="profileCardPhone">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ù…Ø³Ø¬Ù‘Ù„</span>
              <span id="profileCardTelegram">@deman_support</span>
            </div>
          </div>

          <div class="card profile-fields-card">
            <div class="card-header">
              <div>
                <div class="card-title">Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ¸Ù</div>
                <div class="card-sub">
                  Ø­Ø¯Ù‘Ø« Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙƒÙ…ÙˆØ¸Ù ÙÙŠ DEMAN.STORE (Ù…Ø­Ù„ÙŠ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ).
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="profileDisplayNameInput">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¸Ø§Ù‡Ø±</label>
              <input
                type="text"
                id="profileDisplayNameInput"
                placeholder="Ù…Ø«Ø§Ù„: Ø¹Ø¨Ø¯Ø§Ù„ÙØªØ§Ø­ â€“ DEMAN Team"
              >
            </div>

            <div class="form-group">
              <label for="profileTitleInput">Ø§Ù„Ù…Ø³Ù…Ù‘Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label>
              <input
                type="text"
                id="profileTitleInput"
                placeholder="Ù…Ø«Ø§Ù„: Ø£Ø®ØµØ§Ø¦ÙŠ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø­Ø³Ø§Ø¨Ø§Øª Ø³ÙˆÙ†ÙŠ"
              >
            </div>

            <div class="form-group">
              <label for="profilePhoneInput">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
              <input type="text" id="profilePhoneInput" placeholder="05XXXXXXXX">
            </div>

            <div class="form-group">
              <label for="profileTelegramInput">ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… / ÙˆØ³ÙŠÙ„Ø© ØªÙˆØ§ØµÙ„ Ø¯Ø§Ø®Ù„ÙŠØ©</label>
              <input type="text" id="profileTelegramInput" placeholder="@nickname">
            </div>

            <div class="form-group">
              <label for="profileAvatarInput">Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©</label>
              <input type="file" id="profileAvatarInput" accept="image/*" />
              <div class="text-note">
                Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ Ù„ÙŠØªÙ… Ø­ÙØ¸Ù‡Ø§ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­ ÙÙ‚Ø·.
              </div>
            </div>

            <div class="form-group">
              <label for="profileAboutInput">Ù†Ø¨Ø°Ø© Ø¹Ù†Ùƒ</label>
              <textarea
                id="profileAboutInput"
                placeholder="Ù…Ø«Ø§Ù„: Ø®Ø¨Ø±Ø© 3 Ø³Ù†ÙˆØ§Øª ÙÙŠ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§ØªØŒ Ø£Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ±Ø¶Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„..."
              ></textarea>
            </div>

            <button id="saveProfileBtn" class="btn btn-primary" style="width:auto;">
              Ø­ÙØ¸ Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ¸Ù
            </button>
          </div>
        </div>
      </section>
    </main>
  </div>
</section>

<!-- MODAL ADD / EDIT ACCOUNT -->
<div id="accountModalBackdrop" class="modal-backdrop">
  <div class="modal">
    <div class="modal-header">
      <div id="accountModalTitle" class="modal-title">Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</div>
      <button id="closeAccountModal" class="icon-btn">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label for="fieldId">Ø§Ù„Ù€ ID</label>
        <input type="text" id="fieldId" placeholder="Ù…Ø«Ø§Ù„: KingDeman_123">
      </div>
      <div class="form-group">
        <label for="fieldFileNumber">Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù</label>
        <input type="text" id="fieldFileNumber" placeholder="Ù…Ø«Ø§Ù„: 2025-001">
      </div>
      <div class="form-group">
        <label for="fieldEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ / Ø§Ù„Ø£Ø®ÙŠØ±</label>
        <input type="text" id="fieldEmail" placeholder="example@mail.com">
      </div>
      <div class="form-group">
        <label for="fieldProblem">ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</label>
        <textarea
          id="fieldProblem"
          placeholder="Ø­Ø³Ø§Ø¨ Ù…Ø®ØªØ±Ù‚ / ÙÙ‚Ø¯Ø§Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± / ..."
        ></textarea>
      </div>
      <div class="form-group">
        <label for="fieldStatus">Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</label>
        <select id="fieldStatus">
          <option value="">Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</option>
          <option value="Ù‚ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„">Ù‚ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„</option>
          <option value="Ù…ÙƒØªÙ…Ù„">Ù…ÙƒØªÙ…Ù„</option>
          <option value="Ù…Ø±ÙÙˆØ¶">Ù…Ø±ÙÙˆØ¶</option>
          <option value="Ù…Ø¹Ù„Ù‘Ù‚">Ù…Ø¹Ù„Ù‘Ù‚</option>
        </select>
      </div>
      <div class="form-group">
        <label for="fieldMainInfo">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</label>
        <textarea
          id="fieldMainInfo"
          placeholder="Ø£Ù‡Ù… Ù…Ø¹Ù„ÙˆÙ…Ø© Ø¹Ù† Ø§Ù„Ø­Ø§Ù„Ø© Ø£Ùˆ Ø§Ù„Ø¹Ù…ÙŠÙ„"
        ></textarea>
      </div>
      <div class="form-group">
        <label for="fieldNotes">Ø®Ø§Ù†Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
        <textarea
          id="fieldNotes"
          placeholder="ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© â€“ Ù…Ù† Ø¹Ø¯Ù‘Ù„ØŒ Ù…Ø§Ø°Ø§ Ø­Ø¯Ø«..."
        ></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button id="cancelAccountModal" class="btn btn-ghost">Ø¥Ù„ØºØ§Ø¡</button>
      <button id="saveAccountBtn" class="btn btn-primary" style="width:auto;">
        Ø­ÙØ¸
      </button>
    </div>
  </div>
</div>

<!-- MODAL RECENT DETAILS -->
<div id="recentDetailsBackdrop" class="modal-backdrop">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</div>
      <button id="closeRecentDetails" class="icon-btn">âœ•</button>
    </div>
    <div class="modal-body">
      <div
        id="recentDetailsContent"
        style="font-size:0.84rem;line-height:1.7;"
      ></div>
    </div>
    <div class="modal-footer">
      <button
        id="closeRecentDetailsBtn"
        class="btn btn-primary"
        style="width:auto;"
      >
        Ø¥ØºÙ„Ø§Ù‚
      </button>
    </div>
  </div>
</div>

<script>
  const STORAGE_KEY = "deman_panel_state_v2";

  let accounts = [];
  let recentActions = [];
  let payments = [];
  let profile = {
    displayName: "DEMAN Team",
    title: "Ø£Ø®ØµØ§Ø¦ÙŠ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø­Ø³Ø§Ø¨Ø§Øª",
    phone: "",
    telegram: "@deman_support",
    avatarUrl: "",
    avatarData: "",
    about: ""
  };
  let editingIndex = null;

  function loadState() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) {
      accounts = [
        {
          id: "Nickname123",
          fileNumber: "2025-001",
          email: "kingdeman00068@hotmail.com",
          problem: "Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø­Ø³Ø§Ø¨ Ø³ÙˆÙ†ÙŠ â€“ ÙÙ‚Ø¯Ø§Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
          status: "Ù…ÙƒØªÙ…Ù„",
          mainInfo: "ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­",
          notes: "Ù†ØµØ­Ù†Ø§Ù‡ Ø¨ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬",
          lastEditor: "Ø¹Ø¨Ø¯Ø§Ù„ÙØªØ§Ø­",
          updatedAt: new Date()
        }
      ];
      recentActions = [];
      payments = [];
      profile = {
        displayName: "DEMAN Team",
        title: "Ø£Ø®ØµØ§Ø¦ÙŠ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø­Ø³Ø§Ø¨Ø§Øª",
        phone: "",
        telegram: "@deman_support",
        avatarUrl: "",
        avatarData: "",
        about: ""
      };
      return;
    }

    try {
      const s = JSON.parse(raw);
      if (Array.isArray(s.accounts)) accounts = s.accounts;
      if (Array.isArray(s.recentActions)) recentActions = s.recentActions;
      if (Array.isArray(s.payments)) payments = s.payments;
      if (s.profile) profile = Object.assign(profile, s.profile);
      if (s.toolsText && document.getElementById("toolsText")) {
        document.getElementById("toolsText").value = s.toolsText;
      }
    } catch (e) {
      console.error("Error parsing state", e);
    }
  }

  function saveState() {
    const toolsTextEl = document.getElementById("toolsText");
    const toolsText = toolsTextEl ? toolsTextEl.value : "";
    const state = {
      accounts,
      recentActions,
      payments,
      profile,
      toolsText
    };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  function formatDate(d) {
    if (!d) return "";
    const date = new Date(d);
    return date.toLocaleString("en-GB", {
      year: "2-digit",
      month: "2-digit",
      day: "2-digit",
      hour: "2-digit",
      minute: "2-digit"
    });
  }

  function addRecentAction(type, description, by) {
    recentActions.push({
      type,
      description,
      by: by || "DEMAN Team",
      date: new Date()
    });
    renderRecent();
    saveState();
  }

  // Toggle password
  document.querySelectorAll(".toggle-password").forEach(btn => {
    btn.addEventListener("click", () => {
      const targetId = btn.getAttribute("data-target");
      const input = document.getElementById(targetId);
      if (!input) return;
      if (input.type === "password") {
        input.type = "text";
        btn.textContent = "Ø¥Ø®ÙØ§Ø¡";
        btn.style.minWidth = "52px";
        btn.style.textAlign = "center";
      } else {
        input.type = "password";
        btn.textContent = "Ø¹Ø±Ø¶";
      }
    });
  });

  const authSection = document.getElementById("authSection");
  const dashboard = document.getElementById("dashboard");
  const loginView = document.getElementById("view-login");
  const emailCodeView = document.getElementById("view-email-code");
  const emailLabel = document.getElementById("emailLabel");
  const backToLoginBtn = document.getElementById("backToLoginBtn");

  // LOGIN -> /api/login
  document.getElementById("loginForm").addEventListener("submit", async e => {
    e.preventDefault();
    const email = document.getElementById("loginEmail").value.trim();
    const pass = document.getElementById("loginPassword").value;

    if (!email || !pass) {
      alert("Ø±Ø¬Ø§Ø¡Ù‹ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.");
      return;
    }

    try {
      const res = await fetch("/api/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password: pass })
      });

      const data = await res.json().catch(() => ({}));

      if (!res.ok || !data.ok) {
        alert(data.message || "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©.");
        return;
      }

      // Ø¬Ù‡Ø§Ø² Ù…ÙˆØ«ÙˆÙ‚: Ø¯Ø®ÙˆÙ„ Ù…Ø¨Ø§Ø´Ø±
      if (data.skip_code) {
        enterDashboard();
        return;
      }

      // ØºÙŠØ± Ù…ÙˆØ«ÙˆÙ‚: Ù†Ù†ØªÙ‚Ù„ Ù„Ø®Ø·ÙˆØ© Ø§Ù„ÙƒÙˆØ¯
      emailLabel.textContent = data.masked_email || email;
      loginView.classList.remove("active");
      emailCodeView.classList.add("active");
      const codeInput = document.getElementById("emailCodeInput");
      codeInput.value = "";
      codeInput.focus();
    } catch (err) {
      console.error(err);
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
    }
  });

  // BACK TO LOGIN
  backToLoginBtn.addEventListener("click", () => {
    emailCodeView.classList.remove("active");
    loginView.classList.add("active");
  });

  // VERIFY CODE -> /api/verify-code
  document
    .getElementById("emailCodeForm")
    .addEventListener("submit", async e => {
      e.preventDefault();
      const code = document.getElementById("emailCodeInput").value.trim();
      const remember = document.getElementById("rememberDevice")?.checked || false;

      if (!code) {
        alert("Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø±Ø³Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„.");
        return;
      }

      try {
        const res = await fetch("/api/verify-code", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ code, remember_device: remember })
        });

        const data = await res.json().catch(() => ({}));

        if (!res.ok || !data.ok) {
          alert(data.message || "Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­ØŒ ØªØ£ÙƒØ¯ ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
          return;
        }

        enterDashboard();
      } catch (err) {
        console.error(err);
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯.");
      }
    });

  function enterDashboard() {
    authSection.classList.add("hidden");
    dashboard.classList.add("active");
    addRecentAction("Ø¯Ø®ÙˆÙ„", "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© DEMAN", profile.displayName);
    renderProfileUI();
  }

  function resetAuthUI() {
    // ØªÙ†Ø¸ÙŠÙ ÙÙˆØ±Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„
    document.getElementById("loginPassword").value = "";
    document.getElementById("emailCodeInput").value = "";
    const rememberEl = document.getElementById("rememberDevice");
    if (rememberEl) rememberEl.checked = false;

    emailCodeView.classList.remove("active");
    loginView.classList.add("active");
  }

  function initialsFromName(name) {
    return name
      .split(" ")
      .filter(Boolean)
      .map(part => part[0])
      .join("")
      .slice(0, 2)
      .toUpperCase();
  }

  function renderProfileUI() {
    const name = profile.displayName || "DEMAN Team";

    const headerName = document.getElementById("profileNameLabel");
    if (headerName) headerName.textContent = name;

    const headerAvatar = document.getElementById("headerAvatar");
    const menuAvatar = document.getElementById("profileMenuAvatar");
    const profileAvatarBig = document.getElementById("profileAvatarBig");
    const allAvatarEls = [headerAvatar, menuAvatar, profileAvatarBig];

    const avatarSrc = profile.avatarData || profile.avatarUrl || "";

    allAvatarEls.forEach(el => {
      if (!el) return;
      if (avatarSrc) {
        el.style.backgroundImage = "url('" + avatarSrc + "')";
        el.style.backgroundSize = "cover";
        el.style.backgroundPosition = "center";
        el.textContent = "";
      } else {
        el.style.backgroundImage = "";
        el.textContent = initialsFromName(name || "DT");
      }
    });

    const menuName = document.getElementById("profileMenuName");
    if (menuName) menuName.textContent = name;

    const phoneText = profile.phone
      ? "Ø±Ù‚Ù… Ù…ÙˆØ«Ù‘ÙÙ‚: " + profile.phone
      : "Ø¨Ø¯ÙˆÙ† Ø±Ù‚Ù… Ù…ÙˆØ«Ù‘ÙÙ‚ Ø¨Ø¹Ø¯";
    const menuPhone = document.getElementById("profileMenuPhone");
    if (menuPhone) menuPhone.textContent = phoneText;

    const nameInput = document.getElementById("profileDisplayNameInput");
    if (nameInput) nameInput.value = name;

    const titleInput = document.getElementById("profileTitleInput");
    if (titleInput) titleInput.value = profile.title || "";

    const phoneInput = document.getElementById("profilePhoneInput");
    if (phoneInput) phoneInput.value = profile.phone || "";

    const tgInput = document.getElementById("profileTelegramInput");
    if (tgInput) tgInput.value = profile.telegram || "";

    const aboutInput = document.getElementById("profileAboutInput");
    if (aboutInput) aboutInput.value = profile.about || "";

    const cardName = document.getElementById("profileCardName");
    const cardTitle = document.getElementById("profileCardTitle");
    const cardPhone = document.getElementById("profileCardPhone");
    const cardTelegram = document.getElementById("profileCardTelegram");

    if (cardName) cardName.textContent = name;
    if (cardTitle) cardTitle.textContent = profile.title || "ÙØ±ÙŠÙ‚ DEMAN Ù„Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹";
    if (cardPhone) cardPhone.textContent = profile.phone || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ù…Ø³Ø¬Ù‘Ù„";
    if (cardTelegram) cardTelegram.textContent = profile.telegram || "@deman_support";
  }

  // Ø­ÙØ¸ Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ¸Ù
  document.getElementById("saveProfileBtn").addEventListener("click", () => {
    const nameInput = document
      .getElementById("profileDisplayNameInput")
      .value.trim();
    profile.displayName = nameInput || "DEMAN Team";
    profile.title = document.getElementById("profileTitleInput").value.trim();
    profile.phone = document.getElementById("profilePhoneInput").value.trim();
    profile.telegram = document
      .getElementById("profileTelegramInput")
      .value.trim();
    profile.about = document.getElementById("profileAboutInput").value.trim();

    renderProfileUI();
    saveState();
    addRecentAction("ØªØ¹Ø¯ÙŠÙ„ Ù…Ù„Ù", "ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ¸Ù", profile.displayName);
    alert("ØªÙ… Ø­ÙØ¸ Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­.");
  });

  // ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„
  const avatarFileInput = document.getElementById("profileAvatarInput");
  if (avatarFileInput) {
    avatarFileInput.addEventListener("change", () => {
      const file = avatarFileInput.files && avatarFileInput.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        profile.avatarData = e.target.result || "";
        saveState();
        renderProfileUI();
      };
      reader.readAsDataURL(file);
    });
  }

  function renderAccounts(filterText) {
    const list = document.getElementById("accountsList");
    if (!list) return;
    list.innerHTML = "";

    const norm = (filterText || "").trim().toLowerCase();
    const filtered = accounts.filter(acc => {
      if (!norm) return true;
      return (
        (acc.id && acc.id.toLowerCase().includes(norm)) ||
        (acc.email && acc.email.toLowerCase().includes(norm))
      );
    });

    filtered.forEach((acc, index) => {
      const item = document.createElement("div");
      item.className = "list-item";
      item.dataset.index = String(index);

      let statusClass = "status-chip";
      if (acc.status && acc.status.includes("Ù‚ÙŠØ¯")) {
        statusClass += " status-pending";
      }
      if (
        acc.status &&
        (acc.status.includes("Ù…Ø±ÙÙˆØ¶") || acc.status.includes("Ø±ÙØ¶"))
      ) {
        statusClass += " status-rejected";
      }

      item.innerHTML =
        '<div class="list-row-main">' +
        '<div class="list-id">' +
        (acc.id || "Ø¨Ø¯ÙˆÙ† ID") +
        "</div>" +
        '<div class="' +
        statusClass +
        '">' +
        (acc.status || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯") +
        "</div>" +
        "</div>" +
        '<div class="meta-row">' +
        "<span>ğŸ“ " +
        (acc.fileNumber || "Ø¨Ø¯ÙˆÙ† Ø±Ù‚Ù… Ù…Ù„Ù") +
        "</span>" +
        "<span>ğŸ“§ " +
        (acc.email || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯") +
        "</span>" +
        "<span>âœï¸ Ø¢Ø®Ø± ØªØ¹Ø¯ÙŠÙ„: " +
        (acc.lastEditor || "-") +
        "</span>" +
        "</div>";

      item.addEventListener("click", () => openEditAccount(index));
      list.appendChild(item);
    });

    const chip = document.getElementById("resultsChip");
    if (chip) chip.textContent = filtered.length + " Ø­Ø³Ø§Ø¨Ø§Øª";
  }

  function renderRecent() {
    const list = document.getElementById("recentList");
    if (!list) return;
    list.innerHTML = "";

    const arr = recentActions.slice().reverse();
    arr.forEach((action, idx) => {
      const realIndex = recentActions.length - 1 - idx;
      const div = document.createElement("div");
      div.className = "recent-item";
      div.dataset.index = String(realIndex);

      div.innerHTML =
        '<div class="recent-top">' +
        "<span>" +
        action.description +
        "</span>" +
        '<span class="pill">' +
        action.type +
        "</span>" +
        "</div>" +
        '<div style="font-size:0.72rem;opacity:0.78;">' +
        formatDate(action.date) +
        " â€¢ " +
        action.by +
        "</div>";

      div.addEventListener("click", () => openRecentDetails(realIndex));
      list.appendChild(div);
    });
  }

  function renderPayments() {
    const tbody = document.getElementById("paymentsTableBody");
    if (!tbody) return;
    tbody.innerHTML = "";

    payments.forEach(p => {
      const tr = document.createElement("tr");
      tr.innerHTML =
        "<td>" +
        p.total +
        "</td>" +
        "<td>" +
        p.khalid +
        "</td>" +
        "<td>" +
        p.abdulfattah +
        "</td>" +
        "<td>" +
        (p.note || "") +
        "</td>";
      tbody.appendChild(tr);
    });
  }

  // Profile dropdown
  const profileBtn = document.getElementById("profileBtn");
  const profileMenu = document.getElementById("profileMenu");

  profileBtn.addEventListener("click", e => {
    e.stopPropagation();
    profileMenu.style.display =
      profileMenu.style.display === "block" ? "none" : "block";
  });

  document.addEventListener("click", () => {
    profileMenu.style.display = "none";
  });

  profileMenu.addEventListener("click", e => e.stopPropagation());

  document.getElementById("manageAccountItem").addEventListener("click", () => {
    showPanel("profile");
    profileMenu.style.display = "none";
  });

  // LOGOUT -> /api/logout
  document.getElementById("logoutItem").addEventListener("click", async () => {
    try {
      await fetch("/api/logout", { method: "POST" });
    } catch (e) {
      console.warn("logout error (ignored):", e);
    }
    dashboard.classList.remove("active");
    authSection.classList.remove("hidden");
    resetAuthUI();
  });

  // Side menu
  const sideMenu = document.getElementById("sideMenu");
  document.getElementById("menuToggle").addEventListener("click", () => {
    sideMenu.classList.toggle("open");
  });

  function showPanel(name) {
    document
      .querySelectorAll(".view-panel")
      .forEach(v => v.classList.remove("active"));
    const target = document.getElementById("panel-" + name);
    if (target) target.classList.add("active");

    document.querySelectorAll(".tab").forEach(t => {
      t.classList.toggle("active", t.dataset.view === name);
    });
  }

  document.querySelectorAll(".side-item").forEach(item => {
    item.addEventListener("click", () => {
      const v = item.dataset.view;
      showPanel(v);
      sideMenu.classList.remove("open");
    });
  });

  document.querySelectorAll(".tab").forEach(tab => {
    tab.addEventListener("click", () => {
      showPanel(tab.dataset.view);
    });
  });

  // Theme toggle
  document.getElementById("themeToggle").addEventListener("click", () => {
    const isLight = document.body.classList.toggle("light");
    document.getElementById("themeLabel").textContent = isLight
      ? "ÙØ§ØªØ­"
      : "Ø¯Ø§ÙƒÙ†";
  });

  const searchInput = document.getElementById("searchInput");
  searchInput.addEventListener("input", e => {
    renderAccounts(e.target.value);
  });

  // Account modal
  const accountModalBackdrop = document.getElementById("accountModalBackdrop");
  const accountModalTitle = document.getElementById("accountModalTitle");

  function openAddAccount() {
    editingIndex = null;
    accountModalTitle.textContent = "Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯";
    document.getElementById("fieldId").value = "";
    document.getElementById("fieldFileNumber").value = "";
    document.getElementById("fieldEmail").value = "";
    document.getElementById("fieldProblem").value = "";
    document.getElementById("fieldStatus").value = "";
    document.getElementById("fieldMainInfo").value = "";
    document.getElementById("fieldNotes").value = "";
    accountModalBackdrop.style.display = "flex";
  }

  function openEditAccount(index) {
    editingIndex = index;
    const acc = accounts[index];
    accountModalTitle.textContent = "ØªØ¹Ø¯ÙŠÙ„ Ø­Ø³Ø§Ø¨";
    document.getElementById("fieldId").value = acc.id || "";
    document.getElementById("fieldFileNumber").value = acc.fileNumber || "";
    document.getElementById("fieldEmail").value = acc.email || "";
    document.getElementById("fieldProblem").value = acc.problem || "";
    document.getElementById("fieldStatus").value = acc.status || "";
    document.getElementById("fieldMainInfo").value = acc.mainInfo || "";
    document.getElementById("fieldNotes").value = acc.notes || "";
    accountModalBackdrop.style.display = "flex";
  }

  function closeAccountModal() {
    accountModalBackdrop.style.display = "none";
  }

  document.getElementById("addAccountBtn").addEventListener("click", openAddAccount);
  document.getElementById("closeAccountModal").addEventListener("click", closeAccountModal);
  document.getElementById("cancelAccountModal").addEventListener("click", closeAccountModal);

  accountModalBackdrop.addEventListener("click", e => {
    if (e.target === accountModalBackdrop) closeAccountModal();
  });

  document.getElementById("saveAccountBtn").addEventListener("click", () => {
    const id = document.getElementById("fieldId").value.trim();
    if (!id) {
      alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù€ ID Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.");
      return;
    }

    const payload = {
      id,
      fileNumber: document.getElementById("fieldFileNumber").value.trim(),
      email: document.getElementById("fieldEmail").value.trim(),
      problem: document.getElementById("fieldProblem").value.trim(),
      status: document.getElementById("fieldStatus").value.trim(),
      mainInfo: document.getElementById("fieldMainInfo").value.trim(),
      notes: document.getElementById("fieldNotes").value.trim(),
      lastEditor: profile.displayName || "DEMAN Team",
      updatedAt: new Date()
    };

    if (editingIndex === null) {
      accounts.push(payload);
      addRecentAction(
        "Ø¥Ø¶Ø§ÙØ©",
        "ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨: " + id,
        profile.displayName
      );
    } else {
      accounts[editingIndex] = payload;
      addRecentAction(
        "ØªØ¹Ø¯ÙŠÙ„",
        "ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø­Ø³Ø§Ø¨: " + id,
        profile.displayName
      );
    }

    renderAccounts(searchInput.value);
    saveState();
    closeAccountModal();
  });

  // Payments
  document.getElementById("addPaymentBtn").addEventListener("click", () => {
    const val = Number(document.getElementById("paymentInput").value);
    if (!val || val <= 0) {
      alert("Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­.");
      return;
    }
    const khalid = Math.round(val * 0.6);
    const abdulfattah = val - khalid;
    payments.push({ total: val, khalid, abdulfattah, note: "" });
    renderPayments();
    addRecentAction(
      "Ø¯ÙØ¹Ø©",
      "ØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø¯ÙØ¹Ø© Ø¨Ù‚ÙŠÙ…Ø© " + val + " Ø±ÙŠØ§Ù„",
      profile.displayName
    );
    document.getElementById("paymentInput").value = "";
    saveState();
  });

  // Tools text Ø­ÙØ¸
  document.getElementById("saveToolsBtn").addEventListener("click", () => {
    saveState();
    addRecentAction(
      "ØªØ¹Ø¯ÙŠÙ„",
      "ØªÙ… ØªØ­Ø¯ÙŠØ« Ù†Øµ Ø§Ù„Ø£Ø¯ÙˆØ§Øª ÙˆØ§Ù„Ø³ÙŠØ§Ø³Ø§Øª",
      profile.displayName
    );
    alert("ØªÙ… Ø­ÙØ¸ Ù†Øµ Ø§Ù„Ø£Ø¯ÙˆØ§Øª ÙˆØ§Ù„Ø³ÙŠØ§Ø³Ø§Øª.");
  });

  // Build info text
  function buildInfoText() {
    const id = document.getElementById("infoId").value.trim();
    const info = document.getElementById("infoInfo").value.trim();
    const email = document.getElementById("infoEmail").value.trim();
    const pass = document.getElementById("infoPassword").value.trim();

    const parts = [];
    parts.push("Ø§Ù„Ø§ÙŠØ¯ÙŠ");
    parts.push(id || "-");
    parts.push("");
    parts.push("Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ");
    parts.push(info || "-");
    parts.push("");
    parts.push("Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„");
    parts.push(email || "-");
    parts.push("");
    parts.push("Ø§Ù„Ø¨Ø§Ø³ÙˆÙˆØ±Ø¯");
    parts.push(pass || "-");
    parts.push("");
    parts.push(
      "Ù†Ù†ØµØ­Ùƒ Ø¨ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØ§Ù„Ø¨Ø±ÙŠØ¯ ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬ ÙˆØ¹Ø¯Ù… Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø­Ø³Ø§Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"
    );
    parts.push("Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…ØªØ¬Ø± deman.store ğŸ’™ğŸ¤");
    parts.push(
      "ÙƒØ§Ù† Ù…Ø¹Ùƒ Ø¹Ø¨Ø¯Ø§Ù„ÙØªØ§Ø­ØŒ Ø£ØªÙ…Ù†Ù‰ Ø£Ù†Ùƒ Ø±Ø§Ø¶Ù Ø¹Ù† Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ù‚Ø¯Ù‘ÙÙ…Ø© ğŸ’ª"
    );
    parts.push("Ø±Ø£ÙŠÙƒ ÙŠÙ‡Ù…Ù†Ø§ ÙˆØµÙˆØªÙƒ ÙŠÙØ±Ù‚ ğŸ“£ğŸ™");

    return parts.join("\n");
  }

  document.getElementById("buildInfoBtn").addEventListener("click", async () => {
    const text = buildInfoText();
    const preview = document.getElementById("infoPreview");
    preview.value = text;
    try {
      await navigator.clipboard.writeText(text);
      alert("ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù†Øµ ÙˆÙ†Ø³Ø®Ù‡ØŒ Ø¬Ø§Ù‡Ø² Ù„Ù„ØµÙ‚ ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡ Ù„Ù„Ø¹Ù…ÙŠÙ„.");
    } catch (e) {
      alert("ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù†ØµØŒ Ù„ÙƒÙ† Ø§Ù„Ù†Ø³Ø® Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙØ´Ù„. Ø§Ù†Ø³Ø®Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø±Ø¨Ø¹.");
    }
  });

  // Recent details modal
  const recentDetailsBackdrop = document.getElementById("recentDetailsBackdrop");
  const recentDetailsContent = document.getElementById("recentDetailsContent");

  document
    .getElementById("closeRecentDetails")
    .addEventListener("click", () => {
      recentDetailsBackdrop.style.display = "none";
    });

  document
    .getElementById("closeRecentDetailsBtn")
    .addEventListener("click", () => {
      recentDetailsBackdrop.style.display = "none";
    });

  recentDetailsBackdrop.addEventListener("click", e => {
    if (e.target === recentDetailsBackdrop) {
      recentDetailsBackdrop.style.display = "none";
    }
  });

  function openRecentDetails(index) {
    const action = recentActions[index];
    if (!action) return;
    recentDetailsContent.innerHTML =
      "<div><strong>Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:</strong> " +
      action.type +
      "</div>" +
      "<div><strong>Ø§Ù„ÙˆØµÙ:</strong> " +
      action.description +
      "</div>" +
      "<div><strong>Ø¨ÙˆØ§Ø³Ø·Ø©:</strong> " +
      action.by +
      "</div>" +
      "<div><strong>Ø§Ù„ØªØ§Ø±ÙŠØ® (Ù…ÙŠÙ„Ø§Ø¯ÙŠ):</strong> " +
      formatDate(action.date) +
      "</div>";
    recentDetailsBackdrop.style.display = "flex";
  }

  // ÙØªØ­ ØªØ¨ÙˆÙŠØ¨ ØªØ­Ù„ÙŠÙ„ PSN Ù…Ù† Ø§Ù„ÙÙˆØªØ±
  const openPsnBtn = document.getElementById("openPsnPanelFromFooter");
  if (openPsnBtn) {
    openPsnBtn.addEventListener("click", () => {
      if (dashboard.classList.contains("active")) {
        showPanel("psn");
      } else {
        alert("Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø£ÙˆÙ„Ø§Ù‹ØŒ ÙˆØ¨Ø¹Ø¯Ù‡Ø§ Ø§ÙØªØ­ ØªØ¨ÙˆÙŠØ¨ ØªØ­Ù„ÙŠÙ„ PSN Ù…Ù† Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯.");
      }
    });
  }

  // ØªØ­Ù„ÙŠÙ„ Ø­Ø³Ø§Ø¨ PSN
    // ØªØ­Ù„ÙŠÙ„ Ø­Ø³Ø§Ø¨ PSN
  const psnBtn = document.getElementById("psnAnalyzeBtn");
  const psnInput = document.getElementById("psnIdInput");
  const psnResultBox = document.getElementById("psnResultBox");

  if (psnBtn && psnInput && psnResultBox) {
    psnBtn.addEventListener("click", async () => {
      const onlineId = psnInput.value.trim();
      if (!onlineId) {
        alert("Ø±Ø¬Ø§Ø¡Ù‹ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø£ÙŠØ¯ÙŠ (Online ID) Ø£ÙˆÙ„Ø§Ù‹.");
        return;
      }

      psnResultBox.value = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨...";

      try {
        const res = await fetch("/api/psn-analyze", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          // Ù‡Ù†Ø§ Ø£Ù‡Ù… Ù†Ù‚Ø·Ø©: Ù†Ø±Ø³Ù„ online_id
          body: JSON.stringify({ online_id: onlineId })
        });

        const data = await res.json().catch(() => ({}));

        if (!res.ok || !data.ok) {
          psnResultBox.value =
            data.message ||
            "ØªØ¹Ø°Ø± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù€ Online ID Ø£Ùˆ Ø¬Ø±Ù‘Ø¨ Ù„Ø§Ø­Ù‚Ø§Ù‹.";
          return;
        }

        // Ù„Ùˆ Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ ÙŠØ±Ø¬Ù‘Ø¹ Ø±Ø³Ø§Ù„Ø© Ø¬Ø§Ù‡Ø²Ø©ØŒ Ø§Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©
        if (data.message) {
          psnResultBox.value = data.message;
          return;
        }

        // Ø§Ø­ØªÙŠØ§Ø·: Ø¨Ù†Ø§Ø¡ Ù†Øµ ÙŠØ¯ÙˆÙŠ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù„Ùˆ Ù…Ø§ ÙÙŠÙ‡ message
        const lines = [];
        lines.push("Ù†ØªÙŠØ¬Ø© ØªØ­Ù„ÙŠÙ„ Ø­Ø³Ø§Ø¨ PSN");
        lines.push("--------------------------");
        lines.push("Ø§Ù„Ø£ÙŠØ¯ÙŠ: " + (data.online_id || onlineId));

        if (data.region_pretty || data.region) {
          lines.push("Ø§Ù„Ø±ÙŠØ¬Ù†: " + (data.region_pretty || data.region));
        }

        if (data.trophy_summary) {
          lines.push("Ù…Ù„Ø®Øµ Ø§Ù„ØªØ±ÙˆÙÙŠØ²: " + data.trophy_summary);
        }

        if (data.titles_count != null) {
          lines.push("Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ (ØªØ±ÙˆÙÙŠ): " + data.titles_count);
        }

        if (data.friends_total != null) {
          lines.push("Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ Ø§Ù„ÙƒÙ„ÙŠ: " + data.friends_total);
        }

        if (data.friends_online_est != null) {
          lines.push("Ø£ØµØ¯Ù‚Ø§Ø¡ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† (ØªÙ‚Ø¯ÙŠØ±ÙŠ): " + data.friends_online_est);
        }

        if (data.last_played) {
          lines.push("Ø¢Ø®Ø± Ù„Ø¹Ø¨Ø© / Ù†Ø´Ø§Ø·: " + data.last_played);
        }

        if (data.notes) {
          lines.push("");
          lines.push("Ù…Ù„Ø§Ø­Ø¸Ø§Øª:");
          lines.push(data.notes);
        }

        psnResultBox.value =
          lines.length > 0
            ? lines.join("\n")
            : "ØªÙ… Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ù„ÙƒÙ† Ù…Ø§ Ø±Ø¬Ø¹Øª Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±.";
      } catch (err) {
        console.error(err);
        psnResultBox.value = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨.";
      }
    });
  }


  // INIT
  loadState();
  renderAccounts("");
  renderRecent();
  renderPayments();
  renderProfileUI();
</script>
</body>
</html>

